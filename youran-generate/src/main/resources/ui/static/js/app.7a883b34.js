(function(e){function t(t){for(var r,a,l=t[0],s=t[1],c=t[2],u=0,m=[];u<l.length;u++)a=l[u],o[a]&&m.push(o[a][0]),o[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);d&&d(t);while(m.length)m.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,l=1;l<n.length;l++){var s=n[l];0!==o[s]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/ui/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0540":function(e,t,n){"use strict";var r=n("9851"),o=n.n(r);o.a},"0b27":function(e,t,n){"use strict";var r=n("cd65"),o=n.n(r);o.a},"1a83":function(e,t,n){"use strict";var r=n("d5b3"),o=n.n(r);o.a},2043:function(e,t,n){"use strict";var r=n("5d67"),o=n.n(r);o.a},2907:function(e,t,n){"use strict";var r=n("42aa"),o=n.n(r);o.a},"31b5":function(e,t,n){},"3c16":function(e,t,n){"use strict";var r=n("d48f"),o=n.n(r);o.a},"3c55":function(e,t,n){"use strict";var r=n("b47b"),o=n.n(r);o.a},"3fda":function(e,t,n){"use strict";var r=n("eb47"),o=n.n(r);o.a},"42aa":function(e,t,n){},"54f1":function(e,t,n){"use strict";var r=n("624f"),o=n.n(r);o.a},"56d7":function(e,t,n){"use strict";n.r(t);n("7f7f"),n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),o=n("5c96"),i=n.n(o),a=(n("0fae"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",{staticClass:"wrapper"},[n("el-header",{staticStyle:{"background-color":"#409EFF"},attrs:{height:"80px"}},[n("div",{staticClass:"header-logo-wrapper"},[n("svg",{staticClass:"header-logo",attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 32 32","xml:space":"preserve"}},[n("g",[n("path",{attrs:{d:"M29.3,7.5L16.7,0.2c-0.4-0.3-1-0.3-1.4,0L2.7,7.5C2.2,7.7,2,8.2,2,8.7v14.6c0,0.5,0.3,1,0.7,1.2l12.6,7.3\n          c0.2,0.1,0.5,0.2,0.7,0.2c0.2,0,0.5-0.1,0.7-0.2l12.6-7.3c0.4-0.3,0.7-0.7,0.7-1.2V8.7C30,8.2,29.8,7.7,29.3,7.5z M27.2,22.5L16,29\n          L4.8,22.5v-13L16,3l11.2,6.5V22.5z"}}),n("path",{attrs:{d:"M7.1,10.8c-0.4,0.7-0.2,1.5,0.5,1.9l6.9,4v8.7c0,0.8,0.6,1.4,1.4,1.4s1.4-0.6,1.4-1.4v-8.6l6.8-3.8\n          c0.7-0.4,0.9-1.2,0.5-1.9c-0.4-0.7-1.2-0.9-1.9-0.5L16,14.2l-6.9-4C8.4,9.9,7.5,10.1,7.1,10.8z"}})])])]),n("div",{staticClass:"header-title"},[n("h2",{staticStyle:{color:"#FFFFFF",margin:"10px 0"},attrs:{align:"left"}},[e._v("Youran代码自动化平台")])])]),n("el-container",[n("el-aside",{staticClass:"menu",staticStyle:{width:"150px"}},[n("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{router:!0}},[n("el-menu-item",{class:{"is-active":e.isRoutePath("/")},attrs:{index:"/"}},[e._v("首页")]),n("el-menu-item",{class:{"is-active":e.isRouteIndexOf("/project")},attrs:{index:"/project"}},[e._v("项目管理")])],1)],1),n("el-main",{staticClass:"content"},[n("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[n("router-view")],1)],1)],1)],1)}),l=[],s={name:"app",data:function(){return{}},methods:{isRoutePath:function(e){return this.$route.path===e},isRouteIndexOf:function(e){return 0===this.$route.path.indexOf(e)}},created:function(){},watch:{$route:function(e,t){}}},c=s,d=n("2877"),u=Object(d["a"])(c,a,l,!1,null,null,null),m=u.exports,p=n("8c4f"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",[n("el-col",{attrs:{span:24}},[n("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(e.tutorial)}})])],1)],1)},h=[],g=n("339e"),y=n.n(g),b=(n("e4cb"),"## 项目介绍\n\n通过维护元数据，一键生成java后端基础架构，同时还能生成增删改查代码和单元测试。\n生成的项目是基于[spring-boot](https://spring.io/projects/spring-boot/)+[mybatis](http://www.mybatis.org/mybatis-3/)架构；其他附属技术栈包括：\n- [hibernate-validator](http://hibernate.org/validator/releases/)\n- [swagger](https://swagger.io/)(API文档自动生成)\n- [mapstruct](http://mapstruct.org/)(属性映射)\n- 基于[H2](http://www.h2database.com)内存数据库的单元测试\n\n\n## 术语解析\n1. 项目：项目就是一个独立的应用系统，可以基于一个项目生成一整套JavaWeb后端服务系统。\n2. 实体：一个实体对应数据库里一张业务表，同时对应后端一整套增删改查服务，同时实体之间也可以有‘一对多’，‘多对多’等关联关系。\n3. 字段：这里的字段既是数据库业务表中的字段，也是java实体类中的字段，一个字段有非常多的属性可以配置。\n4. 枚举：建议将不常变化的一类常量数据创建成枚举，会在java代码中生成对应的enum类。\n5. 枚举值：枚举类中的字段，有值(value)和描述(desc)两个属性。\n6. 索引：就是mysql业务表中的索引。\n\n## 特色功能\n1. ★★★基于git增量生成代码：支持将代码直接生成到远程git仓库，同时支持在数据变动以后再次生成（只生成差异部分）。\n2. ★反向工程：如果您的应用已经完成了表结构设计，请使用'反向工程'功能将建表语句反向导入项目中，自动生成实体和字段。\n3. 字段复制：支持将已经存在的字段复制，并在指定实体内粘贴，同时支持直接粘贴内置的模板字段。\n4. 多对多关系：支持在两个实体之间的建立多对多关联关系，会在mysql中生成一张关联表，可以设置两个实体之间是否持有对方引用，持有引用的一方会自动生成维护关联关系的rest服务。\n5. 外键关联：在添加字段的时候，可以设置该字段是否外键，外键字段需要关联某个实体的主键，从而可以实现‘一对一’或‘一对多’关联。\n6. 外键级联扩展：设置成外键的字段上可以配置级联字段，级联字段是外键对应的关联表中的业务字段，级联字段可以作为查询条件，也能作为返回结果展示。\n7. 实体ER图：可以在实体列表页选择多个存在关联关系的实体，点击'查看ER图'按钮，即可生成实体关系图。\n8. 代码预览：不需要下载就可以在线浏览生成的代码\n9. 帮助文档：使用本系统的过程中，每个表单项后面都有帮助按钮，可以查看该输入项的详细说明。\n\n## 使用说明\n\n一、最佳方案`推荐`（在本工程中进行模型设计，代码同步到git）\n1. 在gitlab或github之类的代码平台上创建空的工程\n2. 本系统中创建项目并录入git地址\n3. 创建实体\n4. 创建实体字段\n5. 创建枚举及枚举字段【可选】\n6. 创建多对多关联关系【可选】\n7. 创建字段索引【可选】\n8. 执行“提交Git”\n\n\n二、传统方案`不推荐`（设计完表结构后执行反向工程）\n1. 提前设计好表结构\n2. 创建项目\n3. 执行反向工程将建表语句导入项目中\n4. 调整字段的属性（因为反向工程导入的字段信息量太少，部分属性设置了默认值）\n5. 创建枚举及枚举字段【可选】\n6. 创建多对多关联关系【可选】\n7. 生成并下载代码\n\n> 【注意】：如果使用git增量生成代码，远程的auto分支尽量别删，尤其是最新的那个auto分支，因为下一次增量生成的时候是在上个分支基础上进行的。\n\n## 升级日志\n\n#### 2019-09-09\n- 支持代码预览功能\n\n#### 2019-02-27\n- 新增java类型Boolean\n\n#### 2018-11-29\n- 支持spring-boot1和2两个版本的自由选择\n\n#### 2018-10-19\n- 增加项目中文名称字段\n\n#### 2018-07-17\n- 支持查看ER图\n\n#### 2018-07-12\n- 使用标准java doc风格的类注释\n- 删除索引管理页面，字段列表页中增加索引维护功能\n- 可以配置对索引字段增加唯一性校验\n\n#### 2018-06-19\n- 增加国际化支持\n\n#### 2018-06-14\n- 切换mybatis的使用姿势：用传统的Mapper注解模式替换SqlSession模式\n\n#### 2018-05-31\n- 增加反向工程功能\n\n#### 2018-05-30\n- 外键字段增加级联扩展功能\n- core模块中增加默认配置文件，并设置mybatis.config-location\n\n#### 2018-05-08\n- 多对多关联表中增加创建时间字段\n\n#### 2018-04-10\n- 项目实体中增加groupId字段\n\n#### 2018-03-17\n- 增加将代码生成到远程Git仓库的功能\n\n#### 2018-03-09\n- 增加前端编辑表单中每个字段的详细说明（markdown格式）\n\n#### 2018-03-08\n- 生成Maven模块化代码\n\n#### 2018-03-07\n- 移除fastjson依赖，统一换成jackson\n- 修改下载代码压缩包文件名（带上项目名称）\n\n"),v=new y.a.Converter,w=v.makeHtml(b),I={data:function(){return{tutorial:w}}},x=I,j=Object(d["a"])(x,f,h,!1,null,null,null),_=j.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[n("keep-alive",{attrs:{include:"projectList"}},[n("router-view")],1)],1)],1)},F=[],$={},N=Object(d["a"])($,k,F,!1,null,null,null),E=N.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"projectList"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",[e._v("项目管理")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{staticClass:"activeNum",attrs:{span:6}},[e._v("\n      已选择"+e._s(e.activeNum)+"个项目\n    ")]),n("el-col",{staticStyle:{"text-align":"right","margin-bottom":"10px"},attrs:{span:18}},[n("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.handleAdd(t)}}},[e._v("创建项目")])],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"projectTable",staticStyle:{"min-width":"1255px"},attrs:{data:e.list,border:!0,"row-key":"projectId","expand-row-keys":e.expandRowKeys,"element-loading-text":e.loadingText}},[n("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),n("el-table-column",{attrs:{property:"groupId",label:"groupId",width:"160"}}),n("el-table-column",{attrs:{property:"projectName",label:"项目标识",width:"200"}}),n("el-table-column",{attrs:{property:"projectDesc",label:"项目名称"}}),n("el-table-column",{attrs:{property:"author",label:"作者",width:"120"}}),n("el-table-column",{attrs:{property:"packageName",label:"包名",width:"180"}}),n("el-table-column",{attrs:{label:"Git仓库",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.remote?n("icon",{staticClass:"color-success",attrs:{name:"check"}}):e._e(),1!=t.row.remote?n("icon",{staticClass:"color-danger",attrs:{name:"times"}}):e._e()]}}])}),n("el-table-column",{attrs:{label:"代码生成进度",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.progressingProjectIds.find(function(e){return e===t.row.projectId})?n("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:t.row.genCodePercent,status:t.row.genCodeStatus}}):e._e()]}}])}),n("el-table-column",{attrs:{label:"操作",width:"205"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleEntity(t.row)}}},[e._v("实体管理")]),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleConst(t.row)}}},[e._v("枚举管理")]),n("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{trigger:"click"},on:{command:e.handleCommand}},[n("span",{staticClass:"el-dropdown-link button-font"},[e._v("\n            操作"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:{method:"handleEdit",arg:t.row}}},[n("icon",{attrs:{name:"edit",scale:"0.8"}}),e._v(" 编辑\n            ")],1),n("el-dropdown-item",{attrs:{command:{method:"handleReverseEngineering",arg:t.row}}},[n("icon",{attrs:{name:"object-group",scale:"0.8"}}),e._v(" 反向工程\n            ")],1),n("el-dropdown-item",{attrs:{command:{method:"handlePreView",arg:t.row}}},[n("icon",{attrs:{name:"eye",scale:"0.8"}}),e._v(" 代码预览\n            ")],1),n("el-dropdown-item",{attrs:{command:{method:"handleGenCode",arg:t.row}}},[n("icon",{attrs:{name:"download",scale:"0.8"}}),e._v(" 下载代码\n            ")],1),1==t.row.remote?n("el-dropdown-item",{attrs:{command:{method:"handleCommit",arg:t.row}}},[n("icon",{attrs:{name:"brands/git",scale:"0.8"}}),e._v(" 提交Git\n            ")],1):e._e(),n("el-dropdown-item",{attrs:{command:{method:"handleDel",arg:t.row}}},[n("icon",{attrs:{name:"trash-alt",scale:"0.8"}}),e._v(" 删除\n            ")],1)],1)],1)]}}])})],1),n("el-dialog",{attrs:{title:"反向工程",visible:e.reverseEngineeringFormVisible,width:"60%"},on:{"update:visible":function(t){e.reverseEngineeringFormVisible=t}}},[n("el-form",{ref:"reverseEngineeringForm",attrs:{model:e.reverseEngineeringForm,rules:e.reverseEngineeringFormRules,size:"small"}},[n("el-form-item",{attrs:{label:"脚本语言：","label-width":"100px"}},[n("el-radio-group",{model:{value:e.reverseEngineeringForm.dbType,callback:function(t){e.$set(e.reverseEngineeringForm,"dbType",t)},expression:"reverseEngineeringForm.dbType"}},[n("el-radio",{attrs:{border:"",label:"mysql"}},[e._v("MySql")])],1)],1),n("el-form-item",{attrs:{label:"DDL脚本：","label-width":"100px",prop:"ddl"}},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:1e3}},model:{value:e.reverseEngineeringForm.ddl,callback:function(t){e.$set(e.reverseEngineeringForm,"ddl",t)},expression:"reverseEngineeringForm.ddl"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.reverseEngineeringFormVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.handleReverseEngineeringCheck}},[e._v("校 验")]),n("el-button",{attrs:{type:"success"},on:{click:e.handleReverseEngineeringSubmit}},[e._v("反向生成")])],1)],1),n("code-preview",{ref:"codePreview"}),n("iframe",{staticStyle:{display:"none"},attrs:{src:e.downloadUrl}})],1)},C=[],O=(n("20d6"),n("ac6a"),n("7618")),q=n("bc3a"),S=n.n(q),D=n("4328"),L=n.n(D),P=n("64ae"),R="",M=S.a.create({baseURL:R,timeout:6e4,responseType:"json",headers:{"Content-Type":"application/json; charset=utf-8"},paramsSerializer:function(e){return L.a.stringify(e,{arrayFormat:"repeat"})}}),A="api",B="ws_api",z={install:function(e,t){e.prototype.$ajax=M,e.prototype.$common={BASE_API_URL:R,snakeCase:function(e){return Object(P["snakeCase"])(e)},camelCase:function(e){return Object(P["camelCase"])(e)},getProjectOptions:function(){return M.get("/".concat(A,"/meta_project/list"))},getEntityOptions:function(e){return M.get("/".concat(A,"/meta_entity/list"),{params:{projectId:e}})},getFieldOptions:function(e){return M.get("/".concat(A,"/meta_field/list"),{params:{entityId:e}})},getConstOptions:function(e){return M.get("/".concat(A,"/meta_const/list"),{params:{projectId:e,pageSize:1e3,currentPage:1}})},confirm:function(t){return e.prototype.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})},showNotify:function(t,n,r){return e.prototype.$notify({title:n,type:t,message:r})},showNotifyError:function(e){if(!1===e)return this.showNotify("error","出错了","表单校验失败");if("string"===typeof e&&e.constructor===String){if("cancel"===e)return;return this.showNotify("error","出错了",e)}if("object"===Object(O["a"])(e)){if(e.constructor===Error){if(e.response&&e.response.status>=400)return this.showErrorVO(e.response.data);if(e.message)return this.showNotify("error","出错了",e.message)}if(e.code&&"0"!==e.code)return this.showErrorVO(e)}return this.showNotify("error","出错了","")},showErrorVO:function(e){return this.showNotify("error","出错了",e.message)},showMsg:function(t,n){e.prototype.$message({message:n,type:t})},checkResult:function(e){return new Promise(function(t,n){return e.status>=200&&e.status<300?t(e.data):n(new Error(e.data))})},removeBlankField:function(e){var t={};for(var n in e)if("string"===typeof e[n]){var r=e[n].trim();if(""===r)continue;t[n]=r}else t[n]=e[n];return t}},e.directive("focus",{inserted:function(e,t){var n=t.value,r=n.callback;r(n.arg)}})}},V=n("c6e1"),Q=n.n(V),K=n("cc7d"),U=n.n(K),G=n("8dee"),J=n.n(G),H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"codePreview"},[n("el-dialog",{attrs:{title:e.projectName,visible:e.visible,fullscreen:!0},on:{"update:visible":function(t){e.visible=t}}},[n("el-header",{staticClass:"codePath"},[e._l(e.paths,function(t,r){return[n("span",{key:t.key,staticStyle:{"line-height":"23px"}},[r>0?n("i",{staticClass:"el-icon-arrow-right"}):e._e(),n("span",[n("i",{class:t.icon}),e._v(" "+e._s(t.name))])])]})],2),n("el-container",{staticClass:"codeContainer"},[n("el-aside",{directives:[{name:"loading",rawName:"v-loading",value:e.codeTreeLoading,expression:"codeTreeLoading"}],staticClass:"codeAside",attrs:{width:"250px"}},[n("el-tree",{attrs:{props:e.treeProps,data:e.codeTree.tree,"render-content":e.renderTreeNode},on:{"node-click":e.nodeClick}})],1),n("el-container",[n("el-main",{staticClass:"codeMain"},[n("el-tabs",{attrs:{type:"border-card",closable:""},on:{"tab-remove":e.removeTab},model:{value:e.currentTabName,callback:function(t){e.currentTabName=t},expression:"currentTabName"}},e._l(e.codeTabs,function(t){return n("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"tab.loading"}],key:t.name,attrs:{label:t.title,name:t.name,"element-loading-text":"加载中...","element-loading-background":"#313335"}},[n("codemirror",{attrs:{options:e.cmOptions},model:{value:t.content,callback:function(n){e.$set(t,"content",n)},expression:"tab.content"}})],1)}),1)],1)],1)],1)],1)],1)},W=[],X=(n("7514"),n("28a5"),{map:{xml:"hawcons-icon-102-document-file-xml",java:"hawcons-icon-78-document-file-java",yml:"hawcons-icon-103-document-file-yml",properties:"hawcons-icon-48-notebook",md:"hawcons-icon-31-book-bookmark",sql:"hawcons-icon-89-document-file-sql"},cmMode:{xml:"application/xml",java:"text/x-java",yml:"text/x-yaml",properties:"text/x-properties",md:"text/x-markdown",sql:"text/x-mysql"},getIcon:function(e){var t=this.map[e];return t||"hawcons-icon-44-note-text"},getCmMode:function(e){var t=this.cmMode[e];return t||""}}),Y=(n("bb43"),n("8f94")),Z=(n("a7be"),n("8c2e"),n("4ba6"),n("d5e0"),n("ced0"),n("dc5b"),n("ffda"),n("959b"),{name:"code-preview",components:{codemirror:Y["codemirror"]},data:function(){return{projectId:null,projectName:"",treeProps:{children:"children",label:"name"},codeTree:{projectId:null,projectVersion:null,tree:[]},cmOptions:{readOnly:!0,mode:"text/x-java",theme:"base16-dark",lineNumbers:!0,line:!0},codeTreeLoading:!1,currentNode:null,paths:[],fileLoading:!1,codeTabs:[],currentTabName:"",visible:!1}},methods:{initData:function(e,t){this.projectId=e,this.projectName=t,this.codeTree.tree=[],this.paths=[]},show:function(e,t){this.visible=!0,this.initData(e,t),this.queryCodeTree(e)},queryCodeTree:function(e){var t=this;return this.codeTreeLoading=!0,this.$ajax.get("/".concat(A,"/code_preview/").concat(e,"/code_tree")).then(function(e){return t.$common.checkResult(e)}).then(function(e){t.codeTree=e}).catch(function(e){return t.$common.showNotifyError(e)}).finally(function(){t.codeTreeLoading=!1})},renderTreeNode:function(e,t){var n=t.node,r=t.data,o=(t.store,r.dir?"hawcons-icon-94-folder":X.getIcon(r.type));return e("span",[e("i",{attrs:{class:o}}),e("span","     "),e("span",n.label)])},parsePath:function(e){this.paths=[{name:this.projectName,key:this.projectName,icon:"hawcons-icon-94-folder"}];for(var t=e.split("/").filter(function(e){return e}),n=0;n<t.length;n++){var r=t[n],o={name:r,key:n+"_"+r,icon:"hawcons-icon-94-folder"};this.paths.push(o)}},nodeClick:function(e,t){var n=this;if(this.currentNode!==e&&(this.currentNode=e,!e.dir)){var r=this.codeTabs.find(function(t){return t.name===e.path});if(r)this.currentTabName=r.name;else{this.parsePath(e.path);var o=this.addTab(e);this.$ajax.get("/".concat(A,"/code_preview/").concat(this.codeTree.projectId,"/file_content?projectVersion=").concat(this.codeTree.projectId,"&filePath=").concat(encodeURIComponent(e.path)),{responseType:"text"}).then(function(e){return n.$common.checkResult(e)}).then(function(t){n.cmOptions.mode=X.getCmMode(e.type),o.content=t}).catch(function(e){return n.$common.showNotifyError(e)}).finally(function(){o.loading=!1})}}},addTab:function(e){var t={name:e.path,title:e.name,loading:!0,content:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n"};return this.codeTabs.push(t),this.currentTabName=e.path,t},removeTab:function(e){var t=this;this.currentTabName===e&&this.codeTabs.forEach(function(n,r){if(n.name===e){var o=t.codeTabs[r+1]||t.codeTabs[r-1];o&&(t.currentTabName=o.name)}}),this.codeTabs=this.codeTabs.filter(function(t){return t.name!==e})}}}),ee=Z,te=(n("2907"),Object(d["a"])(ee,H,W,!1,null,null,null)),ne=te.exports,re={name:"projectList",components:{CodePreview:ne},data:function(){return{query:{},activeNum:0,selectItems:[],list:[],loading:!1,loadingText:"",reverseEngineeringFormVisible:!1,reverseEngineeringForm:{projectId:null,dbType:"mysql",ddl:""},reverseEngineeringFormRules:{ddl:[{required:!0,message:"请输入DDL脚本",trigger:"blur"},{max:1e4,message:"长度不能超过10000个字符",trigger:"blur"}]},progressingProjectIds:[],downloadUrl:""}},methods:{selectionChange:function(e){this.selectItems=e,this.activeNum=this.selectItems.length},handleDel:function(e){var t=this;this.$common.confirm("是否确认删除").then(function(){return t.$ajax.put("/".concat(A,"/meta_project/deleteBatch"),[e.projectId])}).then(function(e){return t.$common.checkResult(e)}).then(function(){return t.doQuery()}).catch(function(e){return t.$common.showNotifyError(e)})},doQuery:function(){var e=this;this.loading=!0,this.loadingText="列表加载中",this.$ajax.get("/".concat(A,"/meta_project/list"),{params:this.query}).then(function(t){return e.$common.checkResult(t)}).then(function(t){t.forEach(function(e){e.genCodeStatus="success",e.genCodePercent=0,e.genCodeMsg=""}),e.list=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},handleAdd:function(){this.$router.push("/project/add")},handleEntity:function(e){this.$router.push("/project/".concat(e.projectId,"/entity"))},handleConst:function(e){this.$router.push("/project/".concat(e.projectId,"/const"))},handleEdit:function(e){this.$router.push("/project/edit/".concat(e.projectId))},handleShow:function(e){this.$router.push("/project/show/".concat(e.projectId))},handlePreView:function(e){var t=this;this.loading=!0,this.loadingText="代码生成中",this.$ajax.get("/".concat(A,"/code_gen/genCode?projectId=").concat(e.projectId)).then(function(e){return t.$common.checkResult(e)}).then(function(){t.$refs.codePreview.show(e.projectId,e.projectName)}).catch(function(e){return t.$common.showNotifyError(e)}).finally(function(){t.loading=!1})},rowProgressChange:function(e,t){var n=!1;return e.genCodePercent=t.percentage,e.genCodeMsg=t.msg,e.genCodeStatus="text",2===t.status&&(e.genCodeStatus="success",n=!0),3===t.status&&(e.genCodeStatus="exception",n=!0),n},callCodeGenWebSocketService:function(e,t,n,r){var o=this;return new Promise(function(i,a){var l=new U.a("".concat(o.$common.BASE_API_URL,"/").concat(B)),s=Q.a.over(l);s.connect({},function(){var o=J.a.generate();n(),s.subscribe("/code_gen/".concat(e,"_progress/").concat(o),function(e){var t=JSON.parse(e.body),n=r(t);n&&(s.disconnect(),i(t))}),s.send("/code_gen/".concat(e,"/").concat(o),"",t)})})},handleGenCode:function(e){var t=this,n=e.projectId;this.$common.confirm("是否确认下载").then(function(){return t.callCodeGenWebSocketService("genCode",{projectId:n},function(){return t.progressingProjectIds.push(n)},function(n){return t.rowProgressChange(e,n)})}).then(function(e){2===e.status?(t.downloadUrl="".concat(t.$common.BASE_API_URL,"/").concat(A,"/code_gen/downloadCode/").concat(e.sessionId),t.$common.showMsg("success",e.msg)):t.$common.showNotifyError(e.msg)}).finally(function(){return t.removeProgress(e)})},handleReverseEngineering:function(e){this.reverseEngineeringFormVisible=!0,this.reverseEngineeringForm.projectId=e.projectId,this.reverseEngineeringForm.ddl=""},handleReverseEngineeringCheck:function(){var e=this,t=null;this.$refs.reverseEngineeringForm.validate().then(function(){return t=e.$loading(),e.$ajax.post("/".concat(A,"/reverse_engineering/check"),e.reverseEngineeringForm)}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","校验通过")}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},handleReverseEngineeringSubmit:function(){var e=this,t=null;this.$refs.reverseEngineeringForm.validate().then(function(){return t=e.$loading(),e.$ajax.post("/".concat(A,"/reverse_engineering/execute"),e.reverseEngineeringForm)}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","执行成功"),e.reverseEngineeringFormVisible=!1}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},handleCommit:function(e){var t=this,n=e.projectId;this.$common.confirm("是否确认提交到远程git仓库").then(function(){return t.callCodeGenWebSocketService("gitCommit",{projectId:n},function(){return t.progressingProjectIds.push(n)},function(n){return t.rowProgressChange(e,n)})}).then(function(e){2===e.status?t.$common.showMsg("success",e.msg):t.$common.showNotifyError(e.msg)}).finally(function(){return t.removeProgress(e)})},removeProgress:function(e){this.progressingProjectIds.splice(this.progressingProjectIds.findIndex(function(t){return t===e.projectId}),1),e.genCodePercent=0},handleCommand:function(e){this[e.method](e.arg)}},activated:function(){this.doQuery()}},oe=re,ie=(n("3fda"),Object(d["a"])(oe,T,C,!1,null,null,null)),ae=ie.exports,le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"projectFormDiv"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",[e._v("\n      "+e._s(e.edit?"编辑项目":"添加项目")+"\n    ")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"projectForm",staticClass:"projectForm",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small"}},[n("el-form-item",{attrs:{label:"groupId",prop:"groupId"}},[n("help-popover",{attrs:{name:"project.groupId"}},[n("el-input",{attrs:{placeholder:"例如：com.myGroup"},model:{value:e.form.groupId,callback:function(t){e.$set(e.form,"groupId",t)},expression:"form.groupId"}})],1)],1),n("el-form-item",{attrs:{label:"项目标识",prop:"projectName"}},[n("help-popover",{attrs:{name:"project.projectName"}},[n("el-input",{attrs:{placeholder:"例如：bbs"},model:{value:e.form.projectName,callback:function(t){e.$set(e.form,"projectName",t)},expression:"form.projectName"}})],1)],1),n("el-form-item",{attrs:{label:"项目名称",prop:"projectDesc"}},[n("help-popover",{attrs:{name:"project.projectDesc"}},[n("el-input",{attrs:{placeholder:"例如：论坛"},model:{value:e.form.projectDesc,callback:function(t){e.$set(e.form,"projectDesc",t)},expression:"form.projectDesc"}})],1)],1),n("el-form-item",{attrs:{label:"包名",prop:"packageName"}},[n("help-popover",{attrs:{name:"project.packageName"}},[n("el-input",{attrs:{placeholder:"例如：com.cbb.bbs"},model:{value:e.form.packageName,callback:function(t){e.$set(e.form,"packageName",t)},expression:"form.packageName"}})],1)],1),n("el-form-item",{attrs:{label:"作者",prop:"author"}},[n("help-popover",{attrs:{name:"project.author"}},[n("el-input",{attrs:{placeholder:"例如：菜小哥"},model:{value:e.form.author,callback:function(t){e.$set(e.form,"author",t)},expression:"form.author"}})],1)],1),n("el-form-item",{attrs:{label:"spring-boot版本",prop:"feature.bootVersion"}},[n("help-popover",{attrs:{name:"project.feature.bootVersion"}},[n("el-radio-group",{model:{value:e.form.feature.bootVersion,callback:function(t){e.$set(e.form.feature,"bootVersion",t)},expression:"form.feature.bootVersion"}},[n("el-radio",{attrs:{border:"",label:1}},[e._v("1.5.x")]),n("el-radio",{attrs:{border:"",label:2}},[e._v("2.1.x")])],1)],1)],1),n("el-form-item",{attrs:{label:"启用Git仓库",prop:"remote"}},[n("help-popover",{attrs:{name:"project.remote"}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.remote,callback:function(t){e.$set(e.form,"remote",t)},expression:"form.remote"}})],1)],1),1==e.form.remote?[n("el-form-item",{attrs:{label:"Git仓库地址",prop:"remoteUrl"}},[n("help-popover",{attrs:{name:"project.remoteUrl"}},[n("el-input",{attrs:{placeholder:"例如：https://github.com/github/testrepo.git"},model:{value:e.form.remoteUrl,callback:function(t){e.$set(e.form,"remoteUrl",t)},expression:"form.remoteUrl"}})],1)],1),n("el-form-item",{attrs:{label:"Git用户名",prop:"username"}},[n("help-popover",{attrs:{name:"project.username"}},[n("el-input",{attrs:{placeholder:"例如：zhangsan"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1),n("el-form-item",{attrs:{label:"Git密码/token",prop:"password"}},[n("help-popover",{attrs:{name:"project.password"}},[n("el-input",{attrs:{placeholder:"例如：123456"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)]:e._e(),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")]),e.edit?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.reset()}}},[e._v("重置")]):e._e(),n("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],2)],1)],1)],1)},se=[];function ce(){return[{value:"int",label:"INT",selectLabel:"INT(11)",fieldLength:11,disabled:!1},{value:"varchar",label:"VARCHAR",selectLabel:"VARCHAR",disabled:!1},{value:"text",label:"TEXT",selectLabel:"TEXT",disabled:!1},{value:"date",label:"DATE",selectLabel:"DATE",disabled:!1},{value:"datetime",label:"DATETIME",selectLabel:"DATETIME",disabled:!1},{value:"float",label:"FLOAT",selectLabel:"FLOAT",disabled:!1},{value:"double",label:"DOUBLE",selectLabel:"DOUBLE",disabled:!1},{value:"decimal",label:"DECIMAL",selectLabel:"DECIMAL",disabled:!1},{value:"bigint",label:"BIGINT",selectLabel:"BIGINT(20)",fieldLength:20,disabled:!1},{value:"mediumint",label:"MEDIUMINT",selectLabel:"MEDIUMINT(9)",fieldLength:9,disabled:!1},{value:"smallint",label:"SMALLINT",selectLabel:"SMALLINT(6)",fieldLength:6,disabled:!1},{value:"tinyint",label:"TINYINT",selectLabel:"TINYINT(4)",fieldLength:4,disabled:!1}]}for(var de={value:"pk",label:"主键",icon:"key",style:"color: #eb9e05;"},ue={value:"fk",label:"外键",icon:"key",style:"color: #409EFF;"},me=[{value:"deleted",label:"逻辑删除",icon:"ban",style:"color: #ff3366;"},{value:"createdTime",label:"创建时间",icon:"calendar-alt",style:"color: #33cc66;"},{value:"createdBy",label:"创建人员",icon:"user",style:"color: #33cc66;"},{value:"operatedTime",label:"更新时间",icon:"calendar-alt",style:"color: #1C86EE;"},{value:"operatedBy",label:"更新人员",icon:"user",style:"color: #1C86EE;"},{value:"version",label:"乐观锁版本号",icon:"unlock-alt",style:"color: #AB82FF;"}],pe={},fe=0,he=me;fe<he.length;fe++){var ge=he[fe];pe[ge.value]=ge}var ye={boolOptions:[{value:1,label:"是"},{value:0,label:"否"}],getFieldTypeOptions:function(){return ce()},fieldTypeOptions:ce(),showFieldLength:function(e,t){return"date"!==e&&"datetime"!==e&&"text"!==e&&t>0},showFieldScale:function(e){return"decimal"===e||"double"===e||"float"===e},jfieldTypeOptions:[{value:"String",label:"String",defaultFieldType:"varchar",allowFieldTypes:["varchar","text"]},{value:"Integer",label:"Integer",defaultFieldType:"int",allowFieldTypes:["int","mediumint","smallint","tinyint"]},{value:"Short",label:"Short",defaultFieldType:"smallint",allowFieldTypes:["smallint"]},{value:"Long",label:"Long",defaultFieldType:"bigint",allowFieldTypes:["bigint"]},{value:"Date",label:"Date",defaultFieldType:"datetime",allowFieldTypes:["date","datetime"]},{value:"Double",label:"Double",defaultFieldType:"double",allowFieldTypes:["double","decimal"]},{value:"Float",label:"Float",defaultFieldType:"float",allowFieldTypes:["float","decimal"]},{value:"Boolean",label:"Boolean",defaultFieldType:"tinyint",allowFieldTypes:["tinyint"]},{value:"BigDecimal",label:"BigDecimal",defaultFieldType:"decimal",allowFieldTypes:["decimal"]}],queryTypeOptions:[{value:1,label:"等于"},{value:2,label:"like"},{value:3,label:"大于"},{value:4,label:"大于等于"},{value:5,label:"小于"},{value:6,label:"小于等于"},{value:7,label:"between"},{value:8,label:"in"}],getFieldFeatures:function(e){var t=[];if(e.specialField){var n=pe[e.specialField];n&&t.push(n)}return 1===e.primaryKey&&t.push(de),1===e.foreignKey&&t.push(ue),t},specialFieldFeatures:me,constTypeOptions:[{value:1,label:"整型"},{value:2,label:"字符串"}],defaultConstList:[]};function be(e){var t={groupId:"",projectName:"",projectDesc:"",packageName:"",author:"",remote:0,remoteUrl:"",username:"",password:"",feature:{bootVersion:1}};return e&&(t["projectId"]=null),t}function ve(){return{groupId:[{required:!0,message:"请输入groupId",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"},{validator:function(e,t,n){/^[a-z|-]+$/.test(t)||n(new Error("项目名称不合法,只允许小写字母和横杠")),n()},trigger:"blur"}],projectDesc:[{required:!0,message:"请输入项目名称",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],packageName:[{required:!0,message:"请输入包名",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],author:[{required:!0,message:"请输入作者",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],remote:[{required:!0,type:"number",message:"请选择是否启用",trigger:"change"}],remoteUrl:[{max:256,message:"长度不能超过256个字符",trigger:"blur"}],username:[{max:32,message:"长度不能超过32个字符",trigger:"blur"}],password:[{max:32,message:"长度不能超过32个字符",trigger:"blur"}],feature:{bootVersion:[{required:!0,type:"number",message:"请选择spring-boot版本",trigger:"change"}]}}}var we={name:"projectForm",props:["projectId"],data:function(){var e=!!this.projectId;return{edit:e,boolOptions:ye.boolOptions,old:be(e),form:be(e),rules:ve()}},methods:{getProject:function(){var e=this;return this.$ajax.get("/".concat(A,"/meta_project/").concat(this.projectId)).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.old=t}).catch(function(t){return e.$common.showNotifyError(t)})},reset:function(){for(var e in be(!0))this.form[e]=this.old[e]},submit:function(){var e=this,t=null;this.$refs.projectForm.validate().then(function(){return t=e.$loading(),e.edit?e.$ajax.put("/".concat(A,"/meta_project/update"),e.form):e.$ajax.post("/".concat(A,"/meta_project/save"),e.form)}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","操作成功"),e.goBack()}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},goBack:function(){this.$router.push("/project")}},created:function(){var e=this;this.edit&&this.getProject().then(function(){return e.reset()})}},Ie=we,xe=(n("0b27"),Object(d["a"])(Ie,le,se,!1,null,null,null)),je=xe.exports,_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[n("keep-alive",{attrs:{include:"entityList"}},[n("router-view")],1)],1)],1)},ke=[],Fe={},$e=Object(d["a"])(Fe,_e,ke,!1,null,null,null),Ne=$e.exports,Ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"entityList"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",[e._v("实体管理")])],1),n("el-row",{staticStyle:{padding:"10px 0"},attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{staticClass:"activeNum",attrs:{span:6}},[e._v("\n      已选择"+e._s(e.activeNum)+"个实体\n    ")]),n("el-col",{staticStyle:{"text-align":"right"},attrs:{span:18}},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm}},[n("el-form-item",[n("el-select",{attrs:{placeholder:"请选择项目"},on:{change:e.handleQuery},model:{value:e.queryForm.projectId,callback:function(t){e.$set(e.queryForm,"projectId",t)},expression:"queryForm.projectId"}},e._l(e.projectList,function(e){return n("el-option",{key:e.projectId,attrs:{label:e.projectDesc,value:e.projectId}})}),1)],1),n("el-form-item",[n("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.handleAdd(t)}}},[e._v("添加实体")]),n("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.handleMtmAdd(t)}}},[e._v("添加多对多")]),n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleErDiagram(t)}}},[e._v("查看ER图")]),n("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.handleDel(t)}}},[e._v("删除")])],1)],1)],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.list,border:!0},on:{"selection-change":e.selectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"50"}}),n("el-table-column",{attrs:{label:"实体名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.title)+"\n        "),e._l(t.row.mtms,function(r){return[n("el-dropdown",{key:r.mtmId,staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{size:"mini",placement:"bottom-start",trigger:"click"},on:{command:e.handleMtmCommand}},[n("span",{class:["mtm_span",e.activeMtmId==r.mtmId?"mtmActive":"",1==r.holdRefer1&&r.entityId1==t.row.entityId||1==r.holdRefer2&&r.entityId2==t.row.entityId?"mtm_hold_span":"mtm_unhold_span"],attrs:{title:"多对多"},on:{mouseover:function(t){return e.setActiveMtm(r)},mouseout:function(t){return e.clearActiveMtm()}}},[e._v("\n              "+e._s(r.tableName)+"\n            ")]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:{method:"handleMtmDel",arg:[r]}}},[n("icon",{attrs:{name:"trash-alt",scale:"0.7",color:"red"}}),e._v(" 删除多对多\n              ")],1),n("el-dropdown-item",{attrs:{command:{method:"handleMtmEdit",arg:[r]}}},[n("icon",{attrs:{name:"edit",scale:"0.7",color:"red"}}),e._v(" 编辑多对多\n              ")],1)],1)],1)]})]}}])}),n("el-table-column",{attrs:{property:"className",label:"类名"}}),n("el-table-column",{attrs:{property:"tableName",label:"表名"}}),n("el-table-column",{attrs:{label:"分页",width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.pageSign?n("icon",{staticClass:"color-success",attrs:{name:"check"}}):e._e(),1!=t.row.pageSign?n("icon",{staticClass:"color-danger",attrs:{name:"times"}}):e._e()]}}])}),n("el-table-column",{attrs:{property:"desc",label:"描述"}}),n("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleField(t.row)}}},[e._v("字段管理")]),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleSqlPreview(t.row)}}},[e._v("sql预览")])]}}])})],1),n("el-dialog",{attrs:{title:"sql预览",visible:e.sqlPreviewVisible,width:"50%"},on:{"update:visible":function(t){e.sqlPreviewVisible=t}}},[n("el-input",{attrs:{readonly:!0,type:"textarea",autosize:{minRows:10,maxRows:1e3}},model:{value:e.sqlPreview,callback:function(t){e.sqlPreview=t},expression:"sqlPreview"}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.sqlPreviewVisible=!1}}},[e._v("关 闭")])],1)],1),n("er-diagram",{ref:"erDiagram"})],1)},Te=[],Ce=(n("8e6e"),n("456d"),n("75fc")),Oe=n("bd86"),qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"erDiagram"},[n("el-dialog",{attrs:{title:"实体关系图",visible:e.visible,fullscreen:!0},on:{"update:visible":function(t){e.visible=t}}},[n("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"100%"},attrs:{type:"flex",align:"middle"}},[n("div",{staticClass:"erDiagramDiv",attrs:{id:"erDiagramDiv"}})])],1)],1)},Se=[],De=n("6f70"),Le=n.n(De),Pe={name:"er-diagram",data:function(){return{erDiagram:{},loading:!1,visible:!1}},methods:{show:function(e,t){var n=this;this.visible=!0,this.queryErDiagram(e,t).then(function(){return n.renderDiagram()})},queryErDiagram:function(e,t){var n=this;return this.loading=!0,this.$ajax.get("/".concat(A,"/er_diagram/show"),{params:{projectId:e,entityIds:t}}).then(function(e){return n.$common.checkResult(e)}).then(function(e){n.erDiagram=e}).catch(function(e){return n.$common.showNotifyError(e)}).finally(function(){n.loading=!1})},getBrush:function(e){if(!this.brush){var t=Le.a.GraphObject.make;this.brush={bluegrad:t(Le.a.Brush,"Linear",{0:"rgb(150, 150, 250)",.5:"rgb(86, 86, 186)",1:"rgb(86, 86, 186)"}),greengrad:t(Le.a.Brush,"Linear",{0:"rgb(158, 209, 159)",1:"rgb(67, 101, 56)"}),redgrad:t(Le.a.Brush,"Linear",{0:"rgb(206, 106, 100)",1:"rgb(180, 56, 50)"}),yellowgrad:t(Le.a.Brush,"Linear",{0:"rgb(254, 221, 50)",1:"rgb(254, 182, 50)"}),lightgrad:t(Le.a.Brush,"Linear",{1:"#E6E6FA",0:"#FFFAF0"})}}return this.brush[e]},initDiagram:function(){var e=Le.a.GraphObject.make;this.diagram=e(Le.a.Diagram,"erDiagramDiv",{initialContentAlignment:Le.a.Spot.Center,allowDelete:!1,allowCopy:!1,layout:e(Le.a.ForceDirectedLayout),"undoManager.isEnabled":!0});var t=e(Le.a.Panel,"Horizontal",e(Le.a.Shape,{desiredSize:new Le.a.Size(10,10),margin:new Le.a.Margin(0,5,0,0)},new Le.a.Binding("figure","figure"),new Le.a.Binding("fill","color")),e(Le.a.TextBlock,{stroke:"#333333",font:"bold 14px sans-serif",margin:new Le.a.Margin(0,10,0,0)},new Le.a.Binding("text","name")),e(Le.a.TextBlock,{stroke:"#333333",font:"bold 14px sans-serif"},new Le.a.Binding("text","desc")));this.diagram.nodeTemplate=e(Le.a.Node,"Auto",{selectionAdorned:!0,resizable:!0,layoutConditions:Le.a.Part.LayoutStandard&~Le.a.Part.LayoutNodeSized,fromSpot:Le.a.Spot.AllSides,toSpot:Le.a.Spot.AllSides,isShadowed:!0,shadowColor:"#C5C1AA"},new Le.a.Binding("location","location").makeTwoWay(),new Le.a.Binding("desiredSize","visible",function(){return new Le.a.Size(NaN,NaN)}).ofObject("LIST"),e(Le.a.Shape,"Rectangle",{fill:this.getBrush("lightgrad"),stroke:"#756875",strokeWidth:3}),e(Le.a.Panel,"Table",{margin:8,stretch:Le.a.GraphObject.Fill},e(Le.a.RowColumnDefinition,{row:0,sizing:Le.a.RowColumnDefinition.None}),e(Le.a.TextBlock,{row:0,alignment:Le.a.Spot.Center,margin:new Le.a.Margin(0,14,0,2),font:"bold 16px sans-serif"},new Le.a.Binding("text","key")),e("PanelExpanderButton","LIST",{row:0,alignment:Le.a.Spot.TopRight}),e(Le.a.Panel,"Vertical",{name:"LIST",row:1,padding:3,alignment:Le.a.Spot.TopLeft,defaultAlignment:Le.a.Spot.Left,stretch:Le.a.GraphObject.Horizontal,itemTemplate:t},new Le.a.Binding("itemArray","fields")))),this.diagram.linkTemplate=e(Le.a.Link,{selectionAdorned:!0,layerName:"Foreground",reshapable:!0,routing:Le.a.Link.AvoidsNodes,corner:5,curve:Le.a.Link.JumpOver},e(Le.a.Shape,{stroke:"#303B45",strokeWidth:2.5}),e(Le.a.TextBlock,{textAlign:"center",font:"bold 14px sans-serif",stroke:"#1967B3",segmentIndex:0,segmentOffset:new Le.a.Point(NaN,NaN),segmentOrientation:Le.a.Link.OrientUpright},new Le.a.Binding("text","text")),e(Le.a.TextBlock,{textAlign:"center",font:"bold 14px sans-serif",stroke:"#1967B3",segmentIndex:-1,segmentOffset:new Le.a.Point(NaN,NaN),segmentOrientation:Le.a.Link.OrientUpright},new Le.a.Binding("text","toText")))},updateModel:function(){var e=this;this.erDiagram.nodeData.forEach(function(t){return t.fields.forEach(function(t){"pk"===t.type?(t.iskey=!0,t.figure="Decision",t.color=e.getBrush("yellowgrad")):(t.iskey=!1,"fk"===t.type?(t.figure="Decision",t.color=e.getBrush("bluegrad")):"delete"===t.type?(t.figure="ThickX",t.color=e.getBrush("redgrad")):"version"===t.type?(t.figure="PaperTape",t.color=e.getBrush("greengrad")):(t.figure="",t.color=null))})}),this.diagram.model=new Le.a.GraphLinksModel(this.erDiagram.nodeData,this.erDiagram.linkData)},renderDiagram:function(){this.diagram?(this.updateModel(),this.diagram.requestUpdate()):(this.initDiagram(),this.updateModel())}}},Re=Pe,Me=(n("54f1"),Object(d["a"])(Re,qe,Se,!1,null,null,null)),Ae=Me.exports;function Be(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(n,!0).forEach(function(t){Object(Oe["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ve={name:"entityList",components:{ErDiagram:Ae},props:["projectId"],data:function(){return{sqlPreview:"",sqlPreviewVisible:!1,query:{projectId:null},queryForm:{projectId:null},projectList:[],activeNum:0,selectItems:[],list:[],activeMtmId:null,mtms:[],loading:!1}},watch:{mtms:function(e){var t=this;e&&(this.list.forEach(function(e){e.mtms=[]}),e.forEach(function(e){var n=t.list.find(function(t){return t.entityId===e.entityId1}),r=t.list.find(function(t){return t.entityId===e.entityId2});n&&n.mtms.push(e),r&&r.mtms.push(e)}))}},methods:{setActiveMtm:function(e){this.activeMtmId=e.mtmId},clearActiveMtm:function(){this.activeMtmId=null},selectionChange:function(e){this.selectItems=e,this.activeNum=this.selectItems.length},handleDel:function(){var e=this;this.activeNum<=0?this.$common.showMsg("warning","请选择实体"):this.$common.confirm("是否确认删除").then(function(){return e.$ajax.put("/".concat(A,"/meta_entity/deleteBatch"),e.selectItems.map(function(e){return e.entityId}))}).then(function(t){return e.$common.checkResult(t)}).then(function(){return e.doQuery()}).then(function(){return e.doQueryMtm()}).catch(function(t){return e.$common.showNotifyError(t)})},queryProject:function(){var e=this;return this.$common.getProjectOptions().then(function(t){return e.$common.checkResult(t)}).then(function(t){e.projectList=t})},handleQuery:function(){var e=this;this.query=ze({},this.queryForm),this.query.projectId!==parseInt(this.projectId)&&this.$router.push("/project/".concat(this.query.projectId,"/entity")),this.doQuery().then(function(){return e.doQueryMtm()})},doQuery:function(){var e=this;if(this.query.projectId)return this.loading=!0,this.$ajax.get("/".concat(A,"/meta_entity/list"),{params:this.query}).then(function(t){return e.$common.checkResult(t)}).then(function(t){t.forEach(function(e){e.mtms=[]}),e.list=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},doQueryMtm:function(){var e=this;if(this.query.projectId)return this.loading=!0,this.$ajax.get("/".concat(A,"/meta_mtm/list"),{params:{projectId:this.query.projectId}}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.mtms=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},handleMtmCommand:function(e){this[e.method].apply(this,Object(Ce["a"])(e.arg))},handleAdd:function(){this.$router.push("/project/".concat(this.projectId,"/entity/add"))},handleMtmAdd:function(){if(this.selectItems.length&&2===this.selectItems.length){var e=this.selectItems.map(function(e){return e.entityId}).join("-");this.$router.push("/project/".concat(this.projectId,"/entity/mtmAdd/").concat(e))}else this.$common.showMsg("warning","请选择两个实体")},handleMtmEdit:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/mtmEdit/").concat(e.mtmId))},handleMtmDel:function(e){var t=this;this.$common.confirm("请确认是否删除多对多【".concat(e.tableName,"】")).then(function(){return t.$ajax.delete("/".concat(A,"/meta_mtm/").concat(e.mtmId))}).then(function(e){return t.$common.checkResult(e)}).then(function(){return t.doQueryMtm()}).catch(function(e){return t.$common.showNotifyError(e)})},handleErDiagram:function(){if(this.selectItems.length){var e=this.selectItems.map(function(e){return e.entityId});this.$refs.erDiagram.show(this.projectId,e)}else this.$common.showMsg("warning","请选择需要查看的实体")},handleField:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/").concat(e.entityId,"/field"))},handleEdit:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/edit/").concat(e.entityId))},handleShow:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/show/").concat(e.entityId))},handleSqlPreview:function(e){var t=this;this.$ajax.get("/".concat(A,"/code_gen/sqlPreview?entityId=").concat(e.entityId),{responseType:"text"}).then(function(e){return t.$common.checkResult(e)}).then(function(e){t.sqlPreview=e,t.sqlPreviewVisible=!0}).catch(function(e){return t.$common.showNotifyError(e)})},handleCommand:function(e){this[e.method](e.arg)}},activated:function(){var e=this;this.queryProject().then(function(){e.queryForm.projectId=parseInt(e.projectId),e.query.projectId=e.queryForm.projectId}).then(function(){return e.doQuery()}).then(function(){return e.doQueryMtm()})}},Qe=Ve,Ke=(n("80ab"),Object(d["a"])(Qe,Ee,Te,!1,null,null,null)),Ue=Ke.exports,Ge=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"entityFormDiv"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity"}}},[e._v("实体管理")]),n("el-breadcrumb-item",[e._v("\n      "+e._s(e.edit?"编辑实体":"添加实体")+"\n    ")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"entityForm",staticClass:"entityForm",attrs:{rules:e.rules,model:e.form,"label-width":"80px",size:"small"}},[n("el-form-item",{attrs:{label:"项目",prop:"projectId"}},[n("help-popover",{attrs:{name:"entity.projectId"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择项目",disabled:!0},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}},e._l(e.projectList,function(e){return n("el-option",{key:e.projectId,attrs:{label:e.projectDesc,value:e.projectId}})}),1)],1)],1),n("el-form-item",{attrs:{label:"实体名",prop:"title"}},[n("help-popover",{attrs:{name:"entity.title"}},[n("el-input",{attrs:{placeholder:"例如：用户"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),n("el-form-item",{attrs:{label:"类名",prop:"className"}},[n("help-popover",{attrs:{name:"entity.className"}},[n("el-input",{attrs:{placeholder:"例如：User"},model:{value:e.form.className,callback:function(t){e.$set(e.form,"className",t)},expression:"form.className"}})],1)],1),n("el-form-item",{attrs:{label:"表名",prop:"tableName"}},[n("help-popover",{attrs:{name:"entity.tableName"}},[n("el-input",{attrs:{placeholder:"例如：t_user"},model:{value:e.form.tableName,callback:function(t){e.$set(e.form,"tableName",t)},expression:"form.tableName"}})],1)],1),n("el-form-item",{attrs:{label:"分页",prop:"pageSign"}},[n("help-popover",{attrs:{name:"entity.pageSign"}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.pageSign,callback:function(t){e.$set(e.form,"pageSign",t)},expression:"form.pageSign"}})],1)],1),n("el-form-item",{attrs:{label:"描述",prop:"desc"}},[n("help-popover",{attrs:{name:"entity.desc"}},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:100}},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")]),e.edit?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.reset()}}},[e._v("重置")]):e._e(),n("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1)],1)],1)],1)},Je=[];n("5df3");function He(e){var t={projectId:null,title:"",className:"",tableName:"",desc:"",commonCall:1,pageSign:1};return e&&(t["entityId"]=null),t}function We(){return{projectId:[{required:!0,type:"number",message:"请选择项目",trigger:"change"}],title:[{required:!0,message:"请输入实体名",trigger:"blur"},{max:25,message:"长度不能超过25个字符",trigger:"blur"}],className:[{required:!0,message:"请输入类名",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],tableName:[{required:!0,message:"请输入表名",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],pageSign:[{required:!0,type:"number",message:"请选择是否支持分页",trigger:"change"}],desc:[{max:250,message:"长度不能超过250个字符",trigger:"blur"}]}}function Xe(e){var t={projectId:null,needId:!1,bigId:!1,tableName:"",desc:"",entityId1:null,entityId2:null,entityIdField1:"",entityIdField2:"",holdRefer1:1,holdRefer2:1};return e&&(t["mtmId"]=null),t}function Ye(){return{projectId:[{required:!0,type:"number",message:"请选择项目",trigger:"change"}],tableName:[{required:!0,message:"请输入关联表名",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],entityIdField1:[{required:!1,message:"请输入外键字段",trigger:"blur"},{max:64,message:"长度不能超过64个字符",trigger:"blur"}],entityIdField2:[{required:!1,message:"请输入外键字段",trigger:"blur"},{max:64,message:"长度不能超过64个字符",trigger:"blur"}],needId:[{required:!0,type:"boolean",message:"请选择是否需要自增id",trigger:"change"}],bigId:[{required:!0,type:"boolean",message:"请选择id字段类型",trigger:"change"}],entityId1:[{required:!0,type:"number",message:"请选择实体1",trigger:"change"}],entityId2:[{required:!0,type:"number",message:"请选择实体2",trigger:"change"}],holdRefer1:[{required:!0,type:"number",message:"请选择实体1持有引用",trigger:"change"}],holdRefer2:[{required:!0,type:"number",message:"请选择实体2持有引用",trigger:"change"}]}}var Ze={name:"entityForm",props:["projectId","entityId"],data:function(){var e=!!this.entityId;return{edit:e,boolOptions:ye.boolOptions,projectList:[],old:He(e),form:He(e),rules:We()}},methods:{queryProject:function(){var e=this;return this.$common.getProjectOptions().then(function(t){return e.$common.checkResult(t)}).then(function(t){e.projectList=t})},getEntity:function(){var e=this;return this.$ajax.get("/".concat(A,"/meta_entity/").concat(this.entityId)).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.old=t}).catch(function(t){return e.$common.showNotifyError(t)})},reset:function(){for(var e in He(!0))this.form[e]=this.old[e]},submit:function(){var e=this,t=null;this.$refs.entityForm.validate().then(function(){return t=e.$loading(),e.edit?e.$ajax.put("/".concat(A,"/meta_entity/update"),e.form):e.$ajax.post("/".concat(A,"/meta_entity/save"),e.form)}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","操作成功"),e.goBack()}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},goBack:function(){this.$router.push("/project/".concat(this.projectId,"/entity"))}},created:function(){var e=this;this.edit?Promise.all([this.getEntity(),this.queryProject()]).then(function(){return e.reset()}):this.queryProject().then(function(){e.form.projectId=parseInt(e.projectId)})}},et=Ze,tt=(n("3c16"),Object(d["a"])(et,Ge,Je,!1,null,null,null)),nt=tt.exports,rt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mtmFormDiv"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity"}}},[e._v("实体管理")]),n("el-breadcrumb-item",[e._v("\n      "+e._s(e.edit?"编辑多对多":"添加多对多")+"\n    ")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"mtmForm",staticClass:"mtmForm",attrs:{rules:e.rules,model:e.form,"label-width":"140px",size:"small"}},[n("el-form-item",{attrs:{label:"项目",prop:"projectId"}},[n("help-popover",{attrs:{name:"mtm.projectId"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择项目",disabled:!0},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}},e._l(e.projectList,function(e){return n("el-option",{key:e.projectId,attrs:{label:e.projectDesc,value:e.projectId}})}),1)],1)],1),n("el-form-item",{attrs:{label:"关联表名",prop:"tableName"}},[n("help-popover",{attrs:{name:"mtm.tableName"}},[n("el-input",{attrs:{placeholder:"例如：r_user_role"},model:{value:e.form.tableName,callback:function(t){e.$set(e.form,"tableName",t)},expression:"form.tableName"}})],1)],1),n("el-form-item",{attrs:{label:"描述",prop:"desc"}},[n("help-popover",{attrs:{name:"mtm.desc"}},[n("el-input",{attrs:{placeholder:"例如：用户角色关联表",type:"textarea",rows:2},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),n("el-form-item",{attrs:{label:"实体1",prop:"entityId1"}},[n("help-popover",{attrs:{name:"mtm.entityId1"}},[n("el-col",{staticStyle:{"padding-left":"0px"},attrs:{span:12}},[n("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.entityEditable,filterable:"",placeholder:"请选择实体1"},model:{value:e.form.entityId1,callback:function(t){e.$set(e.form,"entityId1",t)},expression:"form.entityId1"}},e._l(e.entityList,function(e){return n("el-option",{key:e.entityId,attrs:{label:e.title,value:e.entityId}})}),1)],1),n("el-col",{staticStyle:{"padding-right":"0px"},attrs:{span:12}},[n("el-radio-group",{attrs:{size:"medium"},model:{value:e.form.holdRefer1,callback:function(t){e.$set(e.form,"holdRefer1",t)},expression:"form.holdRefer1"}},[n("el-radio-button",{key:1,attrs:{label:1}},[e._v("持有引用")]),n("el-radio-button",{key:0,attrs:{label:0}},[e._v("不持有")])],1)],1)],1)],1),n("el-form-item",{attrs:{label:"实体2",prop:"entityId2"}},[n("help-popover",{attrs:{name:"mtm.entityId2"}},[n("el-col",{staticStyle:{"padding-left":"0px"},attrs:{span:12}},[n("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.entityEditable,filterable:"",placeholder:"请选择实体2"},model:{value:e.form.entityId2,callback:function(t){e.$set(e.form,"entityId2",t)},expression:"form.entityId2"}},e._l(e.entityList,function(e){return n("el-option",{key:e.entityId,attrs:{label:e.title,value:e.entityId}})}),1)],1),n("el-col",{staticStyle:{"padding-right":"0px"},attrs:{span:12}},[n("el-radio-group",{attrs:{size:"medium"},model:{value:e.form.holdRefer2,callback:function(t){e.$set(e.form,"holdRefer2",t)},expression:"form.holdRefer2"}},[n("el-radio-button",{key:1,attrs:{label:1}},[e._v("持有引用")]),n("el-radio-button",{key:0,attrs:{label:0}},[e._v("不持有")])],1)],1)],1)],1),n("el-form-item",{attrs:{label:"实体1外键字段",prop:"entityIdField1"}},[n("help-popover",{attrs:{name:"mtm.entityIdField1"}},[n("el-input",{attrs:{placeholder:"默认自动生成"},model:{value:e.form.entityIdField1,callback:function(t){e.$set(e.form,"entityIdField1",t)},expression:"form.entityIdField1"}})],1)],1),n("el-form-item",{attrs:{label:"实体2外键字段",prop:"entityIdField2"}},[n("help-popover",{attrs:{name:"mtm.entityIdField2"}},[n("el-input",{attrs:{placeholder:"默认自动生成"},model:{value:e.form.entityIdField2,callback:function(t){e.$set(e.form,"entityIdField2",t)},expression:"form.entityIdField2"}})],1)],1),n("el-form-item",{attrs:{label:"自增id",prop:"needId"}},[n("help-popover",{attrs:{name:"mtm.needId"}},[n("el-col",{staticStyle:{"padding-left":"0px"},attrs:{span:12}},[n("el-radio-group",{attrs:{size:"medium"},model:{value:e.form.needId,callback:function(t){e.$set(e.form,"needId",t)},expression:"form.needId"}},[n("el-radio-button",{key:!0,attrs:{label:!0}},[e._v("需要")]),n("el-radio-button",{key:!1,attrs:{label:!1}},[e._v("不需要")])],1)],1),n("el-col",{staticStyle:{"padding-right":"0px"},attrs:{span:12}},[n("el-radio-group",{attrs:{disabled:!e.form.needId,size:"medium"},model:{value:e.form.bigId,callback:function(t){e.$set(e.form,"bigId",t)},expression:"form.bigId"}},[n("el-radio-button",{key:!1,attrs:{label:!1}},[e._v("整型")]),n("el-radio-button",{key:!0,attrs:{label:!0}},[e._v("长整型")])],1)],1)],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")]),e.edit?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.reset()}}},[e._v("重置")]):e._e(),n("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1)],1)],1)],1)},ot=[],it={name:"mtmForm",props:["projectId","mtmId","entityIds"],data:function(){var e=!!this.mtmId;return{edit:e,boolOptions:ye.boolOptions,projectList:[],entityList:[],old:Xe(e),form:Xe(e),rules:Ye(),entityEditable:!0}},methods:{queryProject:function(){var e=this;return this.$common.getProjectOptions().then(function(t){return e.$common.checkResult(t)}).then(function(t){e.projectList=t})},queryEntity:function(e){var t=this;return this.$common.getEntityOptions(e).then(function(e){return t.$common.checkResult(e)}).then(function(e){t.entityList=e})},getMtm:function(){var e=this;return this.$ajax.get("/".concat(A,"/meta_mtm/").concat(this.mtmId)).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.old=t}).catch(function(t){return e.$common.showNotifyError(t)})},reset:function(){for(var e in Xe(!0))this.form[e]=this.old[e]},submit:function(){var e=this,t=null;this.$refs.mtmForm.validate().then(function(){return t=e.$loading(),e.edit?e.$ajax.put("/".concat(A,"/meta_mtm/update"),e.form):e.$ajax.post("/".concat(A,"/meta_mtm/save"),e.form)}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","操作成功"),e.goBack()}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},goBack:function(){this.$router.push("/project/".concat(this.projectId,"/entity"))}},created:function(){var e=this;if(this.edit)this.entityEditable=!1,Promise.all([this.getMtm(),this.queryProject(),this.queryEntity(this.projectId)]).then(function(){return e.reset()});else{if(this.form.projectId=parseInt(this.projectId),this.entityIds){var t=this.entityIds.split("-").map(function(e){return parseInt(e)});this.form.entityId1=t[0],this.form.entityId2=t[1]}this.queryProject().then(function(){return e.queryEntity(e.form.projectId)})}}},at=it,lt=(n("f4ca"),Object(d["a"])(at,rt,ot,!1,null,null,null)),st=lt.exports,ct=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[n("keep-alive",{attrs:{include:"fieldList"}},[n("router-view")],1)],1)],1)},dt=[],ut={},mt=Object(d["a"])(ut,ct,dt,!1,null,null,null),pt=mt.exports,ft=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fieldList"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity"}}},[e._v("实体管理")]),n("el-breadcrumb-item",[e._v("字段管理")])],1),n("el-row",{staticStyle:{padding:"10px 0"},attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{staticClass:"activeNum",attrs:{span:4}},[e._v("\n        已选择"+e._s(e.activeNum)+"个字段\n      ")]),n("el-col",{staticStyle:{"text-align":"right"},attrs:{span:20}},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm}},[n("el-form-item",[n("el-cascader",{attrs:{placeholder:"请选择实体",options:e.queryForm.projectEntityOptions},on:{"active-item-change":e.handleProjectChange,change:e.handleQuery},model:{value:e.queryForm.projectEntity,callback:function(t){e.$set(e.queryForm,"projectEntity",t)},expression:"queryForm.projectEntity"}})],1),n("el-form-item",[n("el-badge",{staticClass:"item",attrs:{value:e.cacheFieldTemplateCount,hidden:!e.cacheFieldTemplateCount}},[n("el-button",{ref:"copyButton",staticStyle:{margin:"0 0 2px 10px"},attrs:{type:"success"},nativeOn:{click:function(t){e.addTemplateFormVisible=!0,e.templateForm.template=""}}},[e._v("添加字段")])],1),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleIndexAdd(t)}}},[e._v("创建索引")]),n("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.handleDel(t)}}},[e._v("删除字段")])],1)],1)],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.list,border:!0,"row-class-name":e.rowClassName},on:{"selection-change":e.selectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"39px"}}),n("el-table-column",{attrs:{property:"orderNo",label:"序号",width:"65px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.orderNoEdit?e._e():n("el-button",{staticStyle:{width:"45px","padding-right":"3px","padding-left":"3px"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(e){t.row.orderNoEdit=!t.row.orderNoEdit}}},[e._v("\n            "+e._s(t.row.orderNo)+"\n          ")]),t.row.orderNoEdit?n("el-input-number",{directives:[{name:"focus",rawName:"v-focus",value:{callback:e.doOrderNoFocus,arg:t.row},expression:"{callback: doOrderNoFocus, arg: scope.row}"}],ref:"orderNoInput_"+t.row.fieldId,staticClass:"order-no-input",attrs:{size:"mini",controls:!1,min:1,max:999},on:{blur:function(n){return e.updateOrderNo(t.row)}},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.updateOrderNo(t.row)}},model:{value:t.row.orderNo,callback:function(n){e.$set(t.row,"orderNo",n)},expression:"scope.row.orderNo"}}):e._e()]}}])}),n("el-table-column",{attrs:{label:"字段标题"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-popover",{attrs:{content:t.row.fieldComment,placement:"top",trigger:"click","popper-class":"field-comment-popper"}},[n("el-button",{attrs:{slot:"reference",size:"medium",type:"text"},slot:"reference"},[e._v(e._s(t.row.fieldDesc))])],1),e._l(t.row.indexes,function(r){return[n("el-dropdown",{key:r.indexId,staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{size:"mini",placement:"bottom-start",trigger:"click"},on:{command:e.handleIndexCommand}},[n("span",{class:["index_span",1==r.unique?"index_u_span":1==r.uniqueCheck?"index_check_span":"index_com_span"],attrs:{title:[1==r.unique?"唯一索引":1==r.uniqueCheck?"普通索引(唯一性校验)":"普通索引"]}},[e._v("\n                "+e._s(r.indexName)+"\n              ")]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:{method:"handleDelIndexField",arg:[r,t.row]}}},[n("icon",{attrs:{name:"times",scale:"0.7",color:[1==r.unique?"red":"blue"]}}),e._v(" 删除索引字段\n                ")],1),n("el-dropdown-item",{attrs:{command:{method:"handleDelIndex",arg:[r]}}},[n("icon",{attrs:{name:"trash-alt",scale:"0.7",color:[1==r.unique?"red":"blue"]}}),e._v(" 删除整个索引\n                ")],1),n("el-dropdown-item",{attrs:{command:{method:"handleIndexEdit",arg:[r]}}},[n("icon",{attrs:{name:"edit",scale:"0.7",color:[1==r.unique?"red":"blue"]}}),e._v(" 编辑索引\n                ")],1)],1)],1)]})]}}])}),n("el-table-column",{attrs:{label:"字段名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.jfieldName)+" / "+e._s(t.row.fieldName)+"\n        ")]}}])}),n("el-table-column",{attrs:{label:"字段类型",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("optionLabel")(t.row.jfieldType,"jfieldTypeOptions"))+"\n          / "+e._s(e._f("optionLabel")(t.row.fieldType,"fieldTypeOptions"))+e._s(e._f("lengthAndScale")(t.row))+"\n        ")]}}])}),n("el-table-column",{attrs:{label:"非空",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.notNull?n("icon",{staticClass:"color-success",attrs:{name:"check"}}):e._e(),1!=t.row.notNull?n("icon",{staticClass:"color-danger",attrs:{name:"times"}}):e._e()]}}])}),n("el-table-column",{attrs:{label:"特性",width:"70px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(e.getFieldFeatures(t.row),function(e){return[n("el-tooltip",{key:e.value,staticClass:"item",attrs:{effect:"dark",content:e.label,placement:"right"}},[n("icon",{style:e.style,attrs:{name:e.icon}})],1)]})]}}])}),n("el-table-column",{attrs:{property:"fieldExample",label:"字段示例"}}),n("el-table-column",{attrs:{label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),n("el-button",{ref:"copyButton"+t.row.fieldId,staticStyle:{"margin-left":"5px"},attrs:{disabled:e.fieldCached(t.row.fieldId)||e.fieldToCache(t.row.fieldId),type:"text",size:"medium"},on:{click:function(n){return e.handleCopyOne(t.row,n)}}},[e._v("复制")]),1==t.row.foreignKey?n("el-badge",{staticClass:"cascadeBadge",attrs:{value:t.row.cascadeFieldNum,hidden:!t.row.cascadeFieldNum}},[n("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleShowCascadeExt(t.row)}}},[e._v("级联")])],1):e._e()]}}])})],1),e.mtmEntities.holds.length||e.mtmEntities.unholds.length?[n("div",{staticClass:"mtmEntitiesHeader",staticStyle:{"margin-top":"20px"}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:[],border:!0}},[n("el-table-column",{attrs:{width:"200px",label:"多对多关联实体"}}),n("el-table-column",{attrs:{width:"200px",label:"类名"}}),n("el-table-column",{attrs:{width:"200px",label:"表名"}}),n("el-table-column",{attrs:{label:"描述"}}),n("el-table-column",{attrs:{label:"操作",width:"130"}})],1)],1),n("div",{attrs:{loading:e.mtmEntitiesLoading}},[e.mtmEntities.holds.length?n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.mtmEntities.holds,border:!0,"show-header":!1,"row-class-name":"hold-mtm-row"}},[n("el-table-column",{attrs:{width:"200px",property:"title"}}),n("el-table-column",{attrs:{width:"200px",property:"className"}}),n("el-table-column",{attrs:{width:"200px",property:"tableName"}}),n("el-table-column",{attrs:{property:"desc"}}),n("el-table-column",{attrs:{width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-badge",{staticClass:"cascadeBadge",attrs:{value:t.row.cascadeFieldNum,hidden:!t.row.cascadeFieldNum}},[n("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleShowMtmCascadeExt(t.row,!0)}}},[e._v("级联")])],1)]}}],null,!1,1516165990)})],1):e._e(),e.mtmEntities.unholds.length?n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.mtmEntities.unholds,border:!0,"show-header":!1,"row-class-name":"unhold-mtm-row"}},[n("el-table-column",{attrs:{width:"200px",property:"title"}}),n("el-table-column",{attrs:{width:"200px",property:"className"}}),n("el-table-column",{attrs:{width:"200px",property:"tableName"}}),n("el-table-column",{attrs:{property:"desc"}}),n("el-table-column",{attrs:{width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-badge",{staticClass:"cascadeBadge",attrs:{value:t.row.cascadeFieldNum,hidden:!t.row.cascadeFieldNum}},[n("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleShowMtmCascadeExt(t.row,!1)}}},[e._v("级联")])],1)]}}],null,!1,1504921901)})],1):e._e()],1)]:e._e(),n("el-dialog",{attrs:{title:"请选择字段模板",visible:e.addTemplateFormVisible,width:"30%"},on:{"update:visible":function(t){e.addTemplateFormVisible=t}}},[n("el-form",{attrs:{model:e.templateForm,size:"small"}},[n("el-form-item",{attrs:{label:"模式：","label-width":"100px"}},[n("el-radio-group",{model:{value:e.templateForm.multiple,callback:function(t){e.$set(e.templateForm,"multiple",t)},expression:"templateForm.multiple"}},[n("el-radio",{attrs:{border:"",label:"0"}},[e._v("表单编辑")]),n("el-radio",{attrs:{border:"",label:"1"}},[e._v("批量保存")])],1)],1),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"0"==e.templateForm.multiple,expression:"templateForm.multiple=='0'"}],attrs:{label:"模板：","label-width":"100px"}},[n("el-badge",{staticClass:"item",attrs:{value:e.cacheFieldTemplateCount,hidden:!e.cacheFieldTemplateCount}},[n("el-select",{model:{value:e.templateForm.template,callback:function(t){e.$set(e.templateForm,"template",t)},expression:"templateForm.template"}},[n("el-option-group",[n("el-option",{attrs:{label:"不使用模板",value:""}})],1),e.cacheFieldTemplateCount>0?n("el-option-group",{attrs:{label:"临时模板"}},e._l(e.cacheFieldTemplate,function(t){return n("el-option",{key:t.fieldId,attrs:{label:t.fieldDesc,value:t.fieldId}},[n("span",{staticStyle:{float:"left"}},[n("span",{staticClass:"template-option"},[e._l(e.getFieldFeatures(t),function(e){return[n("icon",{key:e.value,style:e.style,attrs:{name:e.icon}})]})],2),e._v("\n                    "+e._s(t.fieldDesc)+"\n                  ")]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[n("i",{staticClass:"el-icon-delete",on:{click:function(n){return n.stopPropagation(),e.removeFieldTemplate(t.fieldId)}}})])])}),1):e._e(),n("el-option-group",{attrs:{label:"系统内置模板"}},e._l(e.fieldTemplate,function(t,r){return n("el-option",{key:r,attrs:{label:r,value:r}},[n("span",{staticStyle:{float:"left"}},[n("span",{staticClass:"template-option"},[e._l(e.getFieldFeatures(t),function(e){return[n("icon",{key:e.value,style:e.style,attrs:{name:e.icon}})]})],2),e._v("\n                    "+e._s(r)+"\n                  ")])])}),1)],1)],1)],1),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"==e.templateForm.multiple,expression:"templateForm.multiple=='1'"}],attrs:{label:"模板：","label-width":"100px"}},[n("el-badge",{staticClass:"item",attrs:{value:e.cacheFieldTemplateCount,hidden:!e.cacheFieldTemplateCount}},[n("el-select",{attrs:{multiple:"","collapse-tags":""},model:{value:e.templateForm.templates,callback:function(t){e.$set(e.templateForm,"templates",t)},expression:"templateForm.templates"}},[e.cacheFieldTemplateCount>0?n("el-option-group",{attrs:{label:"临时模板"}},e._l(e.cacheFieldTemplate,function(t){return n("el-option",{key:t.fieldId,attrs:{label:t.fieldDesc,value:t.fieldId}},[n("span",{staticStyle:{float:"left"}},[n("span",{staticClass:"template-option"},[e._l(e.getFieldFeatures(t),function(e){return[n("icon",{key:e.value,style:e.style,attrs:{name:e.icon}})]})],2),e._v("\n                    "+e._s(t.fieldDesc)+"\n                  ")]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[n("i",{staticClass:"el-icon-delete",on:{click:function(n){return n.stopPropagation(),e.removeFieldTemplate(t.fieldId)}}})])])}),1):e._e(),n("el-option-group",{attrs:{label:"系统内置模板"}},e._l(e.fieldTemplate,function(t,r){return n("el-option",{key:r,attrs:{label:r,value:r}},[n("span",{staticStyle:{float:"left"}},[n("span",{staticClass:"template-option"},[e._l(e.getFieldFeatures(t),function(e){return[n("icon",{key:e.value,style:e.style,attrs:{name:e.icon}})]})],2),e._v("\n                    "+e._s(r)+"\n                  ")])])}),1)],1)],1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addTemplateFormVisible=!1}}},[e._v("取 消")]),"0"==e.templateForm.multiple?n("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("开始编辑")]):e._e(),"1"==e.templateForm.multiple?n("el-button",{attrs:{type:"success"},on:{click:e.handleAddImm}},[e._v("立即保存")]):e._e()],1)],1),n("el-dialog",{staticClass:"cascadeExtDialog",attrs:{title:"外键级联扩展",visible:e.cascadeExtListVisible,width:"60%"},on:{"update:visible":function(t){e.cascadeExtListVisible=t}}},[n("cascade-ext-list",{ref:"cascadeExtList",on:{cascadeFieldNumChange:e.resetCascadeFieldNum,cascadeFieldNumAdd:e.addCascadeFieldNum}})],1),n("el-dialog",{staticClass:"cascadeExtDialog",attrs:{title:"多对多级联扩展",visible:e.mtmCascadeExtListVisible,width:"60%"},on:{"update:visible":function(t){e.mtmCascadeExtListVisible=t}}},[n("mtm-cascade-ext-list",{ref:"mtmCascadeExtList",on:{cascadeFieldNumChange:e.resetMtmCascadeFieldNum,cascadeFieldNumAdd:e.addMtmCascadeFieldNum}})],1),e._l(e.list,function(e){return n("meteor",{key:e.fieldId,ref:"meteor"+e.fieldId,refInFor:!0})})],2)},ht=[],gt=(n("55dd"),n("6762"),n("2fdb"),n("ac4d"),n("8a81"),n("a481"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"cascadeExtList"},[n("el-row",{staticStyle:{padding:"0px"},attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{staticClass:"activeNum",attrs:{span:4}},[e._v("\n      已选择"+e._s(e.activeNum)+"个字段\n    ")]),n("el-col",{staticStyle:{"text-align":"right","margin-bottom":"10px"},attrs:{span:20}},[n("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.handleAdd(t)}}},[e._v("添加")]),n("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.handleDel(t)}}},[e._v("删除")])],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.list,border:!0},on:{"selection-change":e.selectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"50"}}),n("el-table-column",{attrs:{label:"展示字段"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.cascadeFieldDesc+"("+t.row.cascadeJfieldName+")"))]),t.row.editFlag?n("span",[n("el-select",{attrs:{placeholder:"请选择级联字段"},on:{change:function(n){return e.handleCascadeFieldChange(t.row)}},model:{value:t.row.cascadeFieldId,callback:function(n){e.$set(t.row,"cascadeFieldId",n)},expression:"scope.row.cascadeFieldId"}},e._l(e.cascadeFieldList,function(e){return n("el-option",{key:e.fieldId,attrs:{label:e.fieldDesc+"("+e.jfieldName+")",value:e.fieldId}})}),1)],1):e._e()]}}])}),n("el-table-column",{attrs:{label:"字段别名"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.alias))]),t.row.editFlag?n("span",[n("el-input",{attrs:{placeholder:"字段别名"},model:{value:t.row.alias,callback:function(n){e.$set(t.row,"alias",n)},expression:"scope.row.alias"}})],1):e._e()]}}])}),n("el-table-column",{attrs:{label:"查询条件",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.row.editFlag},model:{value:t.row.query,callback:function(n){e.$set(t.row,"query",n)},expression:"scope.row.query"}})]}}])}),n("el-table-column",{attrs:{label:"列表展示",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.row.editFlag},model:{value:t.row.list,callback:function(n){e.$set(t.row,"list",n)},expression:"scope.row.list"}})]}}])}),n("el-table-column",{attrs:{label:"详情展示",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.row.editFlag},model:{value:t.row.show,callback:function(n){e.$set(t.row,"show",n)},expression:"scope.row.show"}})]}}])}),n("el-table-column",{attrs:{label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),t.row.editFlag?n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleSave(t.row)}}},[e._v("保存")]):e._e()]}}])})],1)],1)}),yt=[],bt={cascadeExtId:null,fieldId:null,entityId:null,alias:"",list:1,show:1,query:1,cascadeEntityId:null,cascadeFieldId:null,cascadeJfieldName:null,cascadeFieldDesc:null,editFlag:!0},vt={name:"cascadeExtList",data:function(){return{entityId:null,fieldId:null,cascadeEntityId:null,cascadeFieldList:[],activeNum:0,selectItems:[],list:[],loading:!1}},methods:{init:function(e,t,n){this.entityId=e,this.fieldId=t,this.cascadeEntityId=n,this.initCascadeFieldOptions(),this.doQuery()},selectionChange:function(e){this.selectItems=e,this.activeNum=this.selectItems.length},initCascadeFieldOptions:function(){var e=this;this.$ajax.get("/".concat(A,"/meta_field/list"),{params:{entityId:this.cascadeEntityId}}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.cascadeFieldList=t}).catch(function(t){return e.$common.showNotifyError(t)})},doQuery:function(){var e=this;this.loading=!0,this.$ajax.get("/".concat(A,"/meta_cascade_ext/list"),{params:{fieldId:this.fieldId}}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.list=t,e.$emit("cascadeFieldNumChange",e.fieldId,e.list.length)}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},handleAdd:function(){var e=Object.assign({},bt,{entityId:this.entityId,fieldId:this.fieldId,cascadeEntityId:this.cascadeEntityId});this.list.unshift(e)},handleEdit:function(e){r["default"].set(e,"editFlag",!0)},handleCascadeFieldChange:function(e){var t=this.cascadeFieldList.find(function(t){return t.fieldId===e.cascadeFieldId});e.alias=t.jfieldName},handleSave:function(e){var t=this,n="/".concat(A,"/meta_cascade_ext/save"),r="post";e.cascadeExtId&&(n="/".concat(A,"/meta_cascade_ext/update"),r="put");var o=this.$loading();this.$ajax[r](n,e).then(function(e){return t.$common.checkResult(e)}).then(function(n){return t.$common.showMsg("success","保存成功"),e.cascadeExtId||(e.cascadeExtId=n.cascadeExtId,t.$emit("cascadeFieldNumAdd",t.fieldId,1)),t.$ajax.get("/".concat(A,"/meta_cascade_ext/").concat(e.cascadeExtId))}).then(function(e){return t.$common.checkResult(e)}).then(function(t){Object.assign(e,t,{editFlag:!1})}).catch(function(e){return t.$common.showNotifyError(e)}).finally(function(){o&&o.close()})},handleDel:function(){var e=this;if(this.activeNum<=0)this.$common.showMsg("warning","请选择字段");else{var t=this.selectItems.map(function(e){return e.cascadeExtId}).filter(function(e){return null!=e});this.$common.confirm("是否确认删除").then(function(){if(t.length>0)return e.$ajax.put("/".concat(A,"/meta_cascade_ext/deleteBatch"),t)}).then(function(t){return e.$common.checkResult(t)}).then(function(){return e.doQuery()}).catch(function(t){return e.$common.showNotifyError(t)})}}}},wt=vt,It=Object(d["a"])(wt,gt,yt,!1,null,null,null),xt=It.exports,jt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mtmCascadeExtList"},[n("el-row",{staticStyle:{padding:"0px"},attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{staticClass:"activeNum",attrs:{span:4}},[e._v("\n      已选择"+e._s(e.activeNum)+"个字段\n    ")]),n("el-col",{staticStyle:{"text-align":"right","margin-bottom":"10px"},attrs:{span:20}},[n("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.handleAdd(t)}}},[e._v("添加")]),n("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.handleDel(t)}}},[e._v("删除")])],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.list,border:!0},on:{"selection-change":e.selectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"50"}}),n("el-table-column",{attrs:{label:"展示字段"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.cascadeFieldDesc+"("+t.row.cascadeJfieldName+")"))]),t.row.editFlag?n("span",[n("el-select",{attrs:{placeholder:"请选择级联字段"},on:{change:function(n){return e.handleCascadeFieldChange(t.row)}},model:{value:t.row.cascadeFieldId,callback:function(n){e.$set(t.row,"cascadeFieldId",n)},expression:"scope.row.cascadeFieldId"}},e._l(e.cascadeFieldList,function(e){return n("el-option",{key:e.fieldId,attrs:{label:e.fieldDesc+"("+e.jfieldName+")",value:e.fieldId}})}),1)],1):e._e()]}}])}),n("el-table-column",{attrs:{label:"查询条件",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.row.editFlag},model:{value:t.row.query,callback:function(n){e.$set(t.row,"query",n)},expression:"scope.row.query"}})]}}])}),n("el-table-column",{attrs:{label:"查询字段别名"},scopedSlots:e._u([{key:"default",fn:function(t){return[1!==t.row.query||t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.alias))]),1===t.row.query&&t.row.editFlag?n("span",[n("el-input",{attrs:{placeholder:"字段别名"},model:{value:t.row.alias,callback:function(n){e.$set(t.row,"alias",n)},expression:"scope.row.alias"}})],1):e._e()]}}])}),this.hold?n("el-table-column",{attrs:{label:"列表展示",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.row.editFlag},model:{value:t.row.list,callback:function(n){e.$set(t.row,"list",n)},expression:"scope.row.list"}})]}}],null,!1,831695234)}):e._e(),this.hold?n("el-table-column",{attrs:{label:"详情展示",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:!t.row.editFlag},model:{value:t.row.show,callback:function(n){e.$set(t.row,"show",n)},expression:"scope.row.show"}})]}}],null,!1,1612583043)}):e._e(),n("el-table-column",{attrs:{label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),t.row.editFlag?n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleSave(t.row)}}},[e._v("保存")]):e._e()]}}])})],1)],1)},_t=[],kt={mtmCascadeExtId:null,mtmId:null,entityId:null,alias:"",list:0,show:0,query:1,cascadeEntityId:null,cascadeFieldId:null,cascadeJfieldName:null,cascadeFieldDesc:null,editFlag:!0},Ft={name:"mtmCascadeExtList",data:function(){return{mtmId:null,entityId:null,cascadeEntityId:null,cascadeFieldList:[],activeNum:0,selectItems:[],list:[],loading:!1,hold:!1}},methods:{init:function(e,t,n,r){this.hold=e,this.mtmId=t,this.entityId=n,this.cascadeEntityId=r,this.initCascadeFieldOptions(),this.doQuery()},selectionChange:function(e){this.selectItems=e,this.activeNum=this.selectItems.length},initCascadeFieldOptions:function(){var e=this;this.$ajax.get("/".concat(A,"/meta_field/list"),{params:{entityId:this.cascadeEntityId}}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.cascadeFieldList=t}).catch(function(t){return e.$common.showNotifyError(t)})},doQuery:function(){var e=this;this.loading=!0,this.$ajax.get("/".concat(A,"/meta_mtm_cascade_ext/list"),{params:{mtmId:this.mtmId,entityId:this.entityId,cascadeEntityId:this.cascadeEntityId}}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.list=t,e.$emit("cascadeFieldNumChange",e.mtmId,e.cascadeEntityId,e.list.length)}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},handleAdd:function(){var e=Object.assign({},kt,{mtmId:this.mtmId,entityId:this.entityId,cascadeEntityId:this.cascadeEntityId});this.list.unshift(e)},handleEdit:function(e){r["default"].set(e,"editFlag",!0)},handleCascadeFieldChange:function(e){var t=this.cascadeFieldList.find(function(t){return t.fieldId===e.cascadeFieldId});e.alias=t.jfieldName},handleSave:function(e){var t=this,n="/".concat(A,"/meta_mtm_cascade_ext/save"),r="post";e.mtmCascadeExtId&&(n="/".concat(A,"/meta_mtm_cascade_ext/update"),r="put");var o=this.$loading();this.$ajax[r](n,e).then(function(e){return t.$common.checkResult(e)}).then(function(n){return t.$common.showMsg("success","保存成功"),e.mtmCascadeExtId||(e.mtmCascadeExtId=n.mtmCascadeExtId,t.$emit("cascadeFieldNumAdd",t.mtmId,t.cascadeEntityId,1)),t.$ajax.get("/".concat(A,"/meta_mtm_cascade_ext/").concat(e.mtmCascadeExtId))}).then(function(e){return t.$common.checkResult(e)}).then(function(t){Object.assign(e,t,{editFlag:!1})}).catch(function(e){return t.$common.showNotifyError(e)}).finally(function(){o&&o.close()})},handleDel:function(){var e=this;if(this.activeNum<=0)this.$common.showMsg("warning","请选择字段");else{var t=this.selectItems.map(function(e){return e.mtmCascadeExtId}).filter(function(e){return null!=e});this.$common.confirm("是否确认删除").then(function(){if(t.length>0)return e.$ajax.put("/".concat(A,"/meta_mtm_cascade_ext/deleteBatch"),t)}).then(function(t){return e.$common.checkResult(t)}).then(function(){return e.doQuery()}).catch(function(t){return e.$common.showNotifyError(t)})}}}},$t=Ft,Nt=Object(d["a"])($t,jt,_t,!1,null,null,null),Et=Nt.exports,Tt={"主键ID(Long)":{jfieldName:"id",fieldName:"id",fieldDesc:"主键",jfieldType:"Long",fieldType:"bigint",fieldLength:20,fieldScale:0,primaryKey:1,autoIncrement:1,defaultValue:"",notNull:1,foreignKey:0,specialField:"",fieldExample:"1",fieldComment:"主键ID",dicType:"",query:0,queryType:null,insert:0,update:0,list:1,listSort:0,show:1,editType:null,orderNo:1},"主键ID(Integer)":{jfieldName:"id",fieldName:"id",fieldDesc:"主键",jfieldType:"Integer",fieldType:"int",fieldLength:11,fieldScale:0,primaryKey:1,autoIncrement:1,defaultValue:"",notNull:1,foreignKey:0,specialField:"",fieldExample:"1",fieldComment:"主键ID",dicType:"",query:0,queryType:null,insert:0,update:0,list:1,listSort:0,show:1,editType:null,orderNo:1},"创建时间":{jfieldName:"createdTime",fieldName:"created_time",fieldDesc:"创建时间",jfieldType:"Date",fieldType:"datetime",fieldLength:0,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"createdTime",fieldExample:"2017-12-07 00:00:00",fieldComment:"创建时间【yyyy-MM-dd HH:mm:ss】",dicType:"",query:0,queryType:null,insert:0,update:0,list:0,listSort:1,show:0,editType:null,orderNo:100},"创建人":{jfieldName:"createdBy",fieldName:"created_by",fieldDesc:"创建人",jfieldType:"String",fieldType:"varchar",fieldLength:20,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"createdBy",fieldExample:"admin",fieldComment:"创建人【最大长度20】",dicType:"",query:0,queryType:null,insert:0,update:0,list:0,listSort:0,show:0,editType:null,orderNo:101},"修改时间":{jfieldName:"operatedTime",fieldName:"operated_time",fieldDesc:"修改时间",jfieldType:"Date",fieldType:"datetime",fieldLength:0,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"operatedTime",fieldExample:"2017-12-07 00:00:00",fieldComment:"修改时间【yyyy-MM-dd HH:mm:ss】",dicType:"",query:0,queryType:null,insert:0,update:0,list:0,listSort:1,show:0,editType:null,orderNo:110},"修改人":{jfieldName:"operatedBy",fieldName:"operated_by",fieldDesc:"修改人",jfieldType:"String",fieldType:"varchar",fieldLength:20,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"operatedBy",fieldExample:"admin",fieldComment:"修改人【最大长度20】",dicType:"",query:0,queryType:null,insert:0,update:0,list:0,listSort:0,show:0,editType:null,orderNo:111},"乐观锁版本号":{jfieldName:"version",fieldName:"version",fieldDesc:"乐观锁版本号",jfieldType:"Integer",fieldType:"int",fieldLength:11,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"version",fieldExample:"1",fieldComment:"乐观锁版本号【整型】",dicType:"",query:0,queryType:null,insert:0,update:0,list:0,listSort:0,show:0,editType:null,orderNo:120},"逻辑删除标识":{jfieldName:"deleted",fieldName:"deleted",fieldDesc:"逻辑删除标识",jfieldType:"Boolean",fieldType:"tinyint",fieldLength:1,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"deleted",fieldExample:"false",fieldComment:"逻辑删除标识【0-未删除，1-已删除】",dicType:"",query:0,queryType:null,insert:0,update:0,list:0,listSort:0,show:0,editType:null,orderNo:130},"排序号":{jfieldName:"orderNo",fieldName:"order_no",fieldDesc:"排序号",jfieldType:"Integer",fieldType:"int",fieldLength:11,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:1,foreignKey:0,specialField:"",fieldExample:"1",fieldComment:"排序号【整型】",dicType:"",query:0,queryType:null,insert:1,update:1,list:1,listSort:1,show:1,editType:null,orderNo:90}},Ct=n("ad44"),Ot=n.n(Ct),qt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"meteor-container"},[n("transition",{on:{"before-enter":e.beforeEnter,enter:e.enter,"after-enter":e.afterEnter}},[e.visible?n("div",{staticClass:"meteor-body"}):e._e()])],1)},St=[],Dt=n("589d"),Lt=n.n(Dt);function Pt(e){var t={top:0,left:0};if(e.offsetParent)while(e.offsetParent)t.top+=e.offsetTop,t.left+=e.offsetLeft,e=e.offsetParent;else e.x?t.left+=e.x:e.x&&(t.top+=e.y);return{x:t.left,y:t.top}}var Rt={name:"meteor",data:function(){return{visible:!1,from:{x:0,y:0},to:{x:0,y:0},curr:{x:0,y:0},duration:100}},methods:{init:function(e,t){this.from=Pt(e),this.to=Pt(t),this.curr=Pt(this.$el)},adjust:function(e,t,n,r){this.from.x+=e,this.from.y+=t,this.to.x+=n,this.to.y+=r},show:function(e){this.duration=e,this.visible=!0},hide:function(){this.visible=!1},beforeEnter:function(e){var t=this.from.x-this.curr.x,n=this.from.y-this.curr.y;Lt()(e,{opacity:.4,translateX:t+"px",translateY:n+"px"},{duration:0})},enter:function(e,t){var n=this.to.x-this.curr.x,r=this.to.y-this.curr.y;Lt()(e,{opacity:1,translateX:n+"px",translateY:r+"px"},{duration:this.duration,easing:"ease-in-out",complete:t})},afterEnter:function(e){this.hide()}}},Mt=Rt,At=(n("2043"),Object(d["a"])(Mt,qt,St,!1,null,null,null)),Bt=At.exports,zt=n("2f62");function Vt(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vt(n,!0).forEach(function(t){Object(Oe["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Kt={name:"fieldList",props:["projectId","entityId"],components:{"cascade-ext-list":xt,"mtm-cascade-ext-list":Et,meteor:Bt},data:function(){return{copyFieldUrl:Ot.a.replace("uistatic","ui/static"),addTemplateFormVisible:!1,fieldTemplate:Tt,templateForm:{multiple:"0",template:"",templates:[]},query:{projectId:null,entityId:null},queryForm:{projectEntityOptions:[],projectEntity:[0,0]},activeNum:0,selectItems:[],list:[],indexes:[],addImmFieldIds:[],loading:!1,cascadeExtListVisible:!1,mtmCascadeExtListVisible:!1,mtmEntitiesLoading:!1,mtmEntities:{holds:[],unholds:[]}}},computed:Qt({},Object(zt["d"])(["cacheFieldTemplateCount","cacheFieldTemplate"]),{},Object(zt["b"])(["fieldCached","fieldToCache"])),watch:{indexes:function(e){var t=this;e&&(this.list.forEach(function(e){e.indexes=[]}),e.forEach(function(e){e.fields.forEach(function(n){var r=t.list.find(function(e){return e.fieldId===n.fieldId});r&&r.indexes.push(e)})}))}},filters:{optionLabel:function(e,t){var n=ye[t],r=!0,o=!1,i=void 0;try{for(var a,l=n[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value;if(s.value===e)return s.label}}catch(c){o=!0,i=c}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}return null},lengthAndScale:function(e){var t="";return ye.showFieldLength(e.fieldType,e.fieldLength)&&(t+="("+e.fieldLength,ye.showFieldScale(e.fieldType)&&(t+=","+e.fieldScale),t+=")"),t}},methods:Qt({},Object(zt["c"])(["removeFieldTemplate","addFieldTemplate","addToCacheFieldTemplate","removeToCacheFieldTemplate"]),{getFieldFeatures:ye.getFieldFeatures,rowClassName:function(e){var t=e.row;if(this.addImmFieldIds.includes(t.fieldId))return"add-imm-field"},selectionChange:function(e){this.selectItems=e,this.activeNum=this.selectItems.length},handleDel:function(){var e=this;this.activeNum<=0?this.$common.showMsg("warning","请选择字段"):this.$common.confirm("是否确认删除").then(function(){return e.$ajax.put("/".concat(A,"/meta_field/deleteBatch"),e.selectItems.map(function(e){return e.fieldId}))}).then(function(t){return e.$common.checkResult(t)}).then(function(){return e.doQuery()}).then(function(){return e.doQueryIndex()}).catch(function(t){return e.$common.showNotifyError(t)})},showMeteor:function(e,t){var n=this.$refs["meteor"+e][0],r=this.$refs["copyButton"+e];n.init(r.$el,this.$refs.copyButton.$el),n.adjust(10,0,89,-10),n.show(t)},handleCopyOne:function(e){var t=this;if(!this.fieldCached(e.fieldId)&&!this.fieldToCache(e.fieldId)){var n=500;this.showMeteor(e.fieldId,n),this.addToCacheFieldTemplate(e),setTimeout(function(){t.removeToCacheFieldTemplate(e),t.addFieldTemplate(e)},n)}},initProjectOptions:function(){var e=this;return this.$common.getProjectOptions().then(function(t){return e.$common.checkResult(t)}).then(function(t){e.queryForm.projectEntityOptions=t.map(function(e){return{value:e.projectId,label:e.projectDesc,children:[]}})})},handleProjectChange:function(e){var t=this,n=e[0],r=this.queryForm.projectEntityOptions.find(function(e){return e.value===n});if(!r.children.length)return this.$common.getEntityOptions(n).then(function(e){return t.$common.checkResult(e)}).then(function(e){r.children=e.map(function(e){return{value:e.entityId,label:e.title}})})},handleQuery:function(){var e=this;null!=this.queryForm.projectEntity[1]?(this.query.projectId=this.queryForm.projectEntity[0],this.query.entityId=this.queryForm.projectEntity[1],this.query.entityId!==parseInt(this.entityId)&&this.$router.push("/project/".concat(this.query.projectId,"/entity/").concat(this.query.entityId,"/field")),this.doQuery().then(function(){return e.doQueryIndex()}).then(function(){return e.doQueryMtmEntities()})):this.$common.showNotifyError("请选择实体")},doQuery:function(){var e=this;if(this.query.projectId&&this.query.entityId)return this.loading=!0,this.$ajax.get("/".concat(A,"/meta_field/list"),{params:Qt({},this.query,{withCascadeFieldNum:1})}).then(function(t){return e.$common.checkResult(t)}).then(function(t){t.forEach(function(e){e.indexes=[],e.orderNoEdit=!1,e.oldOrderNo=e.orderNo}),e.list=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},doQueryIndex:function(){var e=this;if(this.query.projectId&&this.query.entityId)return this.loading=!0,this.$ajax.get("/".concat(A,"/meta_index/list"),{params:this.query}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.indexes=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})},doQueryMtmEntities:function(){var e=this;if(this.query.projectId&&this.query.entityId)return this.mtmEntitiesLoading=!0,this.$ajax.get("/".concat(A,"/meta_entity/").concat(this.query.entityId,"/mtm_entity_list_pair")).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.mtmEntities=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.mtmEntitiesLoading=!1})},handleAdd:function(){this.addTemplateFormVisible=!1;var e="system";"number"===typeof this.templateForm.template&&(e="temp"),this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field/add?type=").concat(e,"&template=").concat(this.templateForm.template))},handleAddImm:function(){var e=this;this.addTemplateFormVisible=!1;var t=this.templateForm.multiple,n=this.templateForm.templates,r=this.templateForm.template,o=function(t,n){return e.$ajax.post("/".concat(A,"/meta_field/save"),Qt({},e.$common.removeBlankField(t),{entityId:e.entityId})).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.addImmFieldIds.push(t.fieldId),n&&(e.$common.showMsg("success","添加成功"),e.doQuery().then(function(){return e.doQueryIndex()}))}).catch(function(t){return e.$common.showNotifyError(t)})},i=function(t,n){return"number"===typeof t?e.$ajax.get("/".concat(A,"/meta_field/").concat(t)).then(function(t){return e.$common.checkResult(t)}).then(function(e){return o(e,n)}).catch(function(t){return e.$common.showNotifyError(t)}):o(Tt[t],n)},a=this.$loading(),l=null;l="0"===t?i(r,!0):Promise.all(n.map(function(e){return i(e)})).then(function(){return e.$common.showMsg("success","添加成功"),e.doQuery().then(function(){return e.doQueryIndex()})}),l.finally(function(){setTimeout(function(){e.addImmFieldIds=[]},6e3),a.close()})},handleEdit:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field/edit/").concat(e.fieldId))},handleShow:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field/show/").concat(e.fieldId))},handleShowCascadeExt:function(e){var t=this;this.cascadeExtListVisible=!0,r["default"].nextTick(function(){return t.$refs.cascadeExtList.init(e.entityId,e.fieldId,e.foreignEntityId)})},resetCascadeFieldNum:function(e,t){var n=this.list.find(function(t){return t.fieldId===e});n.cascadeFieldNum=t},addCascadeFieldNum:function(e,t){var n=this.list.find(function(t){return t.fieldId===e});n.cascadeFieldNum+=t},handleShowMtmCascadeExt:function(e,t){var n=this;this.mtmCascadeExtListVisible=!0,r["default"].nextTick(function(){return n.$refs.mtmCascadeExtList.init(t,e.mtmId,parseInt(n.entityId),e.entityId)})},getMtmEntity:function(e,t){var n=this.mtmEntities.holds.find(function(n){return n.mtmId===e&&n.entityId===t});return n||(n=this.mtmEntities.unholds.find(function(n){return n.mtmId===e&&n.entityId===t})),n},resetMtmCascadeFieldNum:function(e,t,n){var r=this.getMtmEntity(e,t);r.cascadeFieldNum=n},addMtmCascadeFieldNum:function(e,t,n){var r=this.getMtmEntity(e,t);r.cascadeFieldNum+=n},handleIndexCommand:function(e){this[e.method].apply(this,Object(Ce["a"])(e.arg))},handleDelIndexField:function(e,t){var n=this;this.$common.confirm("请确认是否从索引【".concat(e.indexName,"】中删除【").concat(t.fieldDesc,"】字段")).then(function(){return n.$ajax.put("/".concat(A,"/meta_index/").concat(e.indexId,"/removeField"),[t.fieldId])}).then(function(e){return n.$common.checkResult(e)}).then(function(){return n.doQueryIndex()}).catch(function(e){return n.$common.showNotifyError(e)})},handleDelIndex:function(e){var t=this;this.$common.confirm("请确认是否删除索引【".concat(e.indexName,"】")).then(function(){return t.$ajax.delete("/".concat(A,"/meta_index/").concat(e.indexId))}).then(function(e){return t.$common.checkResult(e)}).then(function(){return t.doQueryIndex()}).catch(function(e){return t.$common.showNotifyError(e)})},handleIndexAdd:function(){if(this.selectItems.length){var e=this.selectItems.map(function(e){return e.fieldId}).join("-");this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field/indexAdd/").concat(e))}else this.$common.showMsg("warning","请先选择需要建立索引的字段")},handleIndexEdit:function(e){this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field/indexEdit/").concat(e.indexId))},updateOrderNo:function(e){var t=this;e.oldOrderNo!==e.orderNo?this.$ajax.put("/".concat(A,"/meta_field/update_order_no"),{orderNo:e.orderNo,fieldId:e.fieldId}).then(function(e){return t.$common.checkResult(e)}).then(function(n){e.orderNoEdit=!1,e.oldOrderNo=n,e.orderNo=n,t.fieldListReorder()}).catch(function(e){return t.$common.showNotifyError(e)}):e.orderNoEdit=!1},doOrderNoFocus:function(e){this.$refs["orderNoInput_"+e.fieldId].focus()},fieldListReorder:function(){this.list=this.list.sort(function(e,t){return e.orderNo===t.orderNo?e.fieldId-t.fieldId:e.orderNo-t.orderNo})}}),activated:function(){var e=this,t=parseInt(this.projectId),n=parseInt(this.entityId);this.queryForm.projectEntity[0]=t,this.queryForm.projectEntity[1]=n,this.query.projectId=t,this.query.entityId=n,this.initProjectOptions().then(function(){return e.handleProjectChange([t])}).then(function(){return e.doQuery()}).then(function(){return e.doQueryIndex()}).then(function(){return e.doQueryMtmEntities()})}},Ut=Kt,Gt=(n("1a83"),Object(d["a"])(Ut,ft,ht,!1,null,null,null)),Jt=Gt.exports,Ht=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fieldFormDiv"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity"}}},[e._v("实体管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity/"+this.entityId+"/field"}}},[e._v("字段管理")]),n("el-breadcrumb-item",[e._v("\n      "+e._s(e.edit?"编辑字段":"添加字段")+"\n    ")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("el-col",{attrs:{span:14}},[n("el-form",{ref:"fieldForm",staticClass:"fieldForm",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small"}},[n("el-form-item",{attrs:{label:"是否主键",prop:"primaryKey"}},[n("help-popover",{attrs:{name:"field.primaryKey"}},[n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.primaryKey,callback:function(t){e.$set(e.form,"primaryKey",t)},expression:"form.primaryKey"}},[e._v("是")]),n("el-checkbox",{attrs:{"true-label":1,"false-label":0,disabled:e.autoIncrementDisabled},model:{value:e.form.autoIncrement,callback:function(t){e.$set(e.form,"autoIncrement",t)},expression:"form.autoIncrement"}},[e._v("自增")])],1)],1),n("el-form-item",{attrs:{label:"是否外键",prop:"foreignKey"}},[n("help-popover",{attrs:{name:"field.foreignKey"}},[n("el-row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("el-col",{attrs:{span:6}},[n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.foreignKey,callback:function(t){e.$set(e.form,"foreignKey",t)},expression:"form.foreignKey"}},[e._v("是")])],1),n("el-col",{staticClass:"col-right",attrs:{span:18}},[n("span",{staticClass:"inline-label"},[e._v("外键字段")]),n("el-cascader",{attrs:{disabled:e.foreignFieldDisabled,placeholder:"请选择外键字段",options:e.entityFieldOptions},on:{"active-item-change":e.handleForeignEntityChange},model:{value:e.foreignField,callback:function(t){e.foreignField=t},expression:"foreignField"}})],1)],1)],1)],1),n("el-form-item",{attrs:{label:"序号",prop:"orderNo"}},[n("help-popover",{attrs:{name:"field.orderNo"}},[n("el-row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("el-col",{attrs:{span:8}},[n("el-input-number",{attrs:{min:1},model:{value:e.form.orderNo,callback:function(t){e.$set(e.form,"orderNo",t)},expression:"form.orderNo"}})],1),n("el-col",{staticClass:"col-right",attrs:{span:16}},[n("span",{staticClass:"inline-label"},[e._v("特殊类型")]),n("el-select",{attrs:{disabled:e.specialFieldDisabled,clearable:"",filterable:"",placeholder:"无"},model:{value:e.form.specialField,callback:function(t){e.$set(e.form,"specialField",t)},expression:"form.specialField"}},e._l(e.specialFieldFeatures,function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[n("span",{staticClass:"template-option"},[n("icon",{key:t.value,style:t.style,attrs:{name:t.icon}})],1),e._v("\n                        "+e._s(t.label)+"\n                  ")])}),1)],1)],1)],1)],1),n("el-form-item",{attrs:{label:"字段名",prop:"jfieldName"}},[n("help-popover",{attrs:{name:"field.jfieldName"}},[n("el-col",{staticClass:"col-left",attrs:{span:11}},[n("el-input",{attrs:{placeholder:"java字段名，例如：age"},model:{value:e.form.jfieldName,callback:function(t){e.$set(e.form,"jfieldName",t)},expression:"form.jfieldName"}}),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.form.jfieldName=e.$common.camelCase(e.form.jfieldName)}}},[e._v("转驼峰")])],1),n("el-col",{staticStyle:{"padding-left":"0px","padding-right":"0px","text-align":"center"},attrs:{span:2}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"粘贴到右边并转下划线",placement:"top"}},[n("el-button",{attrs:{type:"text"},on:{click:function(t){return e.copyJfieldNameToFieldName()}}},[n("icon",{staticStyle:{"vertical-align":"middle"},attrs:{name:"angle-double-right"}})],1)],1)],1),n("el-col",{staticClass:"col-right",attrs:{span:11}},[n("el-input",{attrs:{placeholder:"mysql字段名，例如：age"},model:{value:e.form.fieldName,callback:function(t){e.$set(e.form,"fieldName",t)},expression:"form.fieldName"}}),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.form.fieldName=e.$common.snakeCase(e.form.fieldName)}}},[e._v("转下划线")])],1)],1)],1),n("el-form-item",{attrs:{label:"字段标题",prop:"fieldDesc"}},[n("help-popover",{attrs:{name:"field.fieldDesc"}},[n("el-input",{attrs:{placeholder:"字段标题，例如：年龄"},model:{value:e.form.fieldDesc,callback:function(t){e.$set(e.form,"fieldDesc",t)},expression:"form.fieldDesc"}})],1)],1),n("el-form-item",{attrs:{label:"字段备注",prop:"fieldComment"}},[n("help-popover",{attrs:{name:"field.fieldComment"}},[n("el-input",{attrs:{type:"textarea",rows:2,placeholder:"字段备注，例如：年龄【整型】"},model:{value:e.form.fieldComment,callback:function(t){e.$set(e.form,"fieldComment",t)},expression:"form.fieldComment"}})],1)],1),n("el-form-item",{attrs:{label:"字段示例",prop:"fieldExample"}},[n("help-popover",{attrs:{name:"field.fieldExample"}},[n("el-input",{attrs:{placeholder:"字段示例，例如年龄字段：21"},model:{value:e.form.fieldExample,callback:function(t){e.$set(e.form,"fieldExample",t)},expression:"form.fieldExample"}})],1)],1),n("el-form-item",{attrs:{label:"字段类型",prop:"fieldType"}},[n("help-popover",{attrs:{name:"field.fieldType"}},[n("el-col",{staticClass:"col-left",attrs:{span:6}},[n("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"java类型"},on:{change:e.jfieldTypeChange},model:{value:e.form.jfieldType,callback:function(t){e.$set(e.form,"jfieldType",t)},expression:"form.jfieldType"}},e._l(e.jfieldTypeOptions,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),n("el-col",{attrs:{span:6}},[n("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"sql类型"},on:{change:e.fieldTypeChange},model:{value:e.form.fieldType,callback:function(t){e.$set(e.form,"fieldType",t)},expression:"form.fieldType"}},e._l(e.fieldTypeOptions,function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value,disabled:t.disabled}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.selectLabel))])])}),1)],1),e.fieldLengthVisible&&e.fieldScaleVisible?[n("el-col",{attrs:{span:6}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"长度"},model:{value:e.form.fieldLength,callback:function(t){e.$set(e.form,"fieldLength",t)},expression:"form.fieldLength"}})],1),n("el-col",{staticClass:"col-right",attrs:{span:6}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"精度"},model:{value:e.form.fieldScale,callback:function(t){e.$set(e.form,"fieldScale",t)},expression:"form.fieldScale"}})],1)]:e._e(),e.fieldLengthVisible&&!e.fieldScaleVisible?[n("el-col",{staticClass:"col-right",attrs:{span:12}},[n("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"长度"},model:{value:e.form.fieldLength,callback:function(t){e.$set(e.form,"fieldLength",t)},expression:"form.fieldLength"}})],1)]:e._e()],2)],1),n("el-form-item",{attrs:{label:"枚举字典",prop:"dicType"}},[n("help-popover",{attrs:{name:"field.dicType"}},[n("el-autocomplete",{staticStyle:{width:"100%"},attrs:{disabled:e.dicTypeDisabled,"fetch-suggestions":e.queryDicType,placeholder:"请输入枚举字典"},model:{value:e.form.dicType,callback:function(t){e.$set(e.form,"dicType",t)},expression:"form.dicType"}})],1)],1),n("el-form-item",{attrs:{label:"非空",prop:"notNull"}},[n("help-popover",{attrs:{name:"field.notNull"}},[n("el-checkbox",{attrs:{disabled:e.notNullDisabled,"true-label":1,"false-label":0},model:{value:e.form.notNull,callback:function(t){e.$set(e.form,"notNull",t)},expression:"form.notNull"}},[e._v("是")])],1)],1),n("el-form-item",{attrs:{label:"可搜索",prop:"query"}},[n("help-popover",{attrs:{name:"field.query"}},[n("el-row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("el-col",{attrs:{span:6}},[n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.query,callback:function(t){e.$set(e.form,"query",t)},expression:"form.query"}},[e._v("是")])],1),n("el-col",{staticClass:"col-right",attrs:{span:18}},[n("span",{staticClass:"inline-label"},[e._v("搜索方式")]),n("el-select",{attrs:{disabled:e.queryTypeDisabled,clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.form.queryType,callback:function(t){e.$set(e.form,"queryType",t)},expression:"form.queryType"}},e._l(e.queryTypeOptions,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1)],1),n("el-form-item",{attrs:{label:"字段属性"}},[n("help-popover",{attrs:{name:"field.attributes"}},[n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.insert,callback:function(t){e.$set(e.form,"insert",t)},expression:"form.insert"}},[e._v("可插入")]),n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.update,callback:function(t){e.$set(e.form,"update",t)},expression:"form.update"}},[e._v("可修改")]),n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.list,callback:function(t){e.$set(e.form,"list",t)},expression:"form.list"}},[e._v("列表展示")]),n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.show,callback:function(t){e.$set(e.form,"show",t)},expression:"form.show"}},[e._v("详情展示")]),n("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.listSort,callback:function(t){e.$set(e.form,"listSort",t)},expression:"form.listSort"}},[e._v("可排序")])],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")]),e.edit?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.reset()}}},[e._v("重置")]):e._e(),n("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1)],1)],1),n("el-backtop",{attrs:{target:".el-main"}})],1)},Wt=[];function Xt(e){var t={entityId:null,jfieldName:"",fieldName:"",fieldDesc:"",jfieldType:"",fieldType:"",fieldLength:0,fieldScale:0,primaryKey:0,autoIncrement:0,defaultValue:"",notNull:0,foreignKey:0,foreignEntityId:null,foreignFieldId:null,specialField:"",fieldExample:"",fieldComment:"",dicType:"",query:0,queryType:null,insert:1,update:1,list:1,listSort:0,show:1,editType:null,orderNo:1};return e&&(t["fieldId"]=null),t}function Yt(e){return{jfieldName:[{required:!0,message:"请输入字段名",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],fieldName:[{required:!0,message:"请输入mysql字段名",trigger:"blur"},{max:64,message:"长度不能超过64个字符",trigger:"blur"}],fieldDesc:[{required:!0,message:"请输入字段描述",trigger:"blur"},{max:40,message:"长度不能超过40个字符",trigger:"blur"}],jfieldType:[{required:!0,type:"string",message:"请选择java字段类型",trigger:"change"}],fieldType:[{required:!0,type:"string",message:"请选择mysql字段类型",trigger:"change"}],fieldLength:[{required:!0,message:"请输入字段长度",trigger:"blur"}],fieldScale:[{required:!0,message:"请输入字段精度",trigger:"blur"}],primaryKey:[{required:!1,type:"number",message:"请选择是否主键",trigger:"change"}],notNull:[{required:!1,type:"number",message:"请选择不能为空",trigger:"change"}],foreignKey:[{required:!1,type:"number",message:"请选择是否外键",trigger:"change"}],fieldExample:[{required:!0,message:"请输入字段示例",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],fieldComment:[{required:!0,message:"请输入字段备注",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],dicType:[{max:40,message:"长度不能超过40个字符",trigger:"blur"}],query:[{required:!1,type:"number",message:"请选择是否查询字段",trigger:"change"}],queryType:[{validator:function(t,n,r){n||1!==e.form.query?r():r(new Error("请选择查询方式"))},trigger:"change"}],orderNo:[{required:!0,message:"请输入排序号",trigger:"blur"}]}}function Zt(e){var t={entityId:null,indexName:"",unique:0,uniqueCheck:0,fieldIds:[]};return e&&(t["indexId"]=null),t}function en(){return{indexName:[{required:!0,message:"请输入索引名",trigger:"blur"},{max:20,message:"长度不能超过20个字符",trigger:"blur"}],unique:[{required:!0,type:"number",message:"请选择是否唯一",trigger:"change"}],uniqueCheck:[{required:!0,type:"number",message:"请选择唯一性校验",trigger:"change"}],fieldIds:[{required:!0,type:"array",message:"请选择字段",trigger:"change"}]}}var tn={name:"fieldForm",props:["projectId","entityId","fieldId"],data:function(){var e=!!this.fieldId;return{edit:e,boolOptions:ye.boolOptions,fieldTypeOptions:ye.getFieldTypeOptions(),jfieldTypeOptions:ye.jfieldTypeOptions,queryTypeOptions:ye.queryTypeOptions,specialFieldFeatures:ye.specialFieldFeatures,entityFieldOptions:[],constList:null,notNullDisabled:!1,autoIncrementDisabled:!0,queryTypeDisabled:!0,specialFieldDisabled:!1,foreignField:[0,0],foreignFieldDisabled:!0,old:Xt(e),form:Xt(e),rules:Yt(this)}},computed:{dicTypeDisabled:function(){return!(1!==this.form.primaryKey&&!this.form.specialField)},fieldLengthVisible:function(){return ye.showFieldLength(this.form.fieldType,1)},fieldScaleVisible:function(){return ye.showFieldScale(this.form.fieldType)}},watch:{"form.primaryKey":function(e){1===e?(this.form.notNull=1,this.notNullDisabled=!0,this.form.specialField="",this.specialFieldDisabled=!0,this.autoIncrementDisabled=!1):(this.notNullDisabled=!1,this.specialFieldDisabled=!1,this.form.autoIncrement=0,this.autoIncrementDisabled=!0)},"form.foreignKey":function(e){this.foreignFieldDisabled=1!==e},"form.query":function(e){1===e?this.queryTypeDisabled=!1:(this.queryTypeDisabled=!0,this.form.queryType="")},dicTypeDisabled:function(e){e&&(this.form.dicType="")}},methods:{jfieldTypeChange:function(e){if(e){var t=this.jfieldTypeOptions.find(function(t){return t.value===e});if(t&&t.allowFieldTypes){if(!t.allowFieldTypes.includes(this.form.fieldType)){this.form.fieldType=t.defaultFieldType;var n=this.fieldTypeOptions.find(function(e){return e.value===t.defaultFieldType});this.form.fieldLength=n.fieldLength}this.fieldTypeOptions.forEach(function(e){t.allowFieldTypes.includes(e.value)?e.disabled=!1:e.disabled=!0})}}else this.fieldTypeOptions=ye.getFieldTypeOptions()},fieldTypeChange:function(e){if(e){var t=this.fieldTypeOptions.find(function(t){return t.value===e});t&&t.fieldLength&&(this.form.fieldLength=t.fieldLength)}},initForeignEntityOptions:function(){var e=this;return this.$common.getEntityOptions(this.projectId).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.entityFieldOptions=t.map(function(e){return{value:e.entityId,label:e.title,children:[]}})})},handleForeignEntityChange:function(e){var t=this,n=e[0],r=this.entityFieldOptions.find(function(e){return e.value===n});if(r&&!r.children.length)return this.$common.getFieldOptions(n).then(function(e){return t.$common.checkResult(e)}).then(function(e){r.children=e.filter(function(e){return 1===e.primaryKey}).map(function(e){return{value:e.fieldId,label:e.fieldDesc}})})},queryDicType:function(e,t){var n=this,r=function(){var r=n.constList.slice(0);r.push.apply(r,Object(Ce["a"])(ye.defaultConstList));var o=e?r.filter(function(t){return 0===t.constName.toLowerCase().indexOf(e.toLowerCase())}):r;t(o.map(function(e){return{value:e.constName}}))};this.constList?r():this.$common.getConstOptions(this.projectId).then(function(e){return n.$common.checkResult(e)}).then(function(e){n.constList=e.list,r()})},getField:function(){var e=this;return this.$ajax.get("/".concat(A,"/meta_field/").concat(this.fieldId)).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.old=t}).catch(function(t){return e.$common.showNotifyError(t)})},reset:function(){for(var e in Xt(!0))this.form[e]=this.old[e]},submit:function(){var e=this;ye.showFieldScale(this.form.fieldType)||(this.form.fieldScale=null),this.form.foreignEntityId=this.foreignField[0],this.form.foreignFieldId=this.foreignField[1];var t=null;this.$refs.fieldForm.validate().then(function(){return t=e.$loading(),e.edit?e.$ajax.put("/".concat(A,"/meta_field/update"),e.$common.removeBlankField(e.form)):e.$ajax.post("/".concat(A,"/meta_field/save"),e.$common.removeBlankField(e.form))}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","操作成功"),e.goBack()}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},goBack:function(){this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field"))},copyJfieldNameToFieldName:function(){this.form.fieldName=this.$common.snakeCase(this.form.jfieldName)}},created:function(){var e=this;if(this.edit)Promise.all([this.getField(),this.initForeignEntityOptions()]).then(function(){return e.reset()}).then(function(){return e.handleForeignEntityChange([e.form.foreignEntityId])}).then(function(){e.foreignField=[e.form.foreignEntityId,e.form.foreignFieldId]}).catch(function(t){return e.this.$common.showNotifyError(t)});else{var t=parseInt(this.entityId);this.form.entityId=t;var n=this.initForeignEntityOptions(),r=this.$router.currentRoute.query.type,o=this.$router.currentRoute.query.template;if(!o)return;if("system"===r&&(this.form=Tt[o],this.form.entityId=t),"temp"===r){var i=this.$ajax.get("/".concat(A,"/meta_field/").concat(o)).then(function(t){return e.$common.checkResult(t)}).then(function(n){return new Promise(function(r,o){return e.form=n,e.form.entityId=t,r()})});Promise.all([n,i]).then(function(){if(e.form.foreignFieldId&&e.form.foreignEntityId)return e.handleForeignEntityChange([e.form.foreignEntityId]).then(function(){e.foreignField=[e.form.foreignEntityId,e.form.foreignFieldId]})}).catch(function(t){return e.$common.showNotifyError(t)})}}}},nn=tn,rn=(n("3c55"),Object(d["a"])(nn,Ht,Wt,!1,null,null,null)),on=rn.exports,an=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"indexFormDiv"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity"}}},[e._v("实体管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/entity/"+this.entityId+"/field"}}},[e._v("字段管理")]),n("el-breadcrumb-item",[e._v("\n      "+e._s(e.edit?"编辑索引":"添加索引")+"\n    ")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"indexForm",staticClass:"indexForm",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small"}},[n("el-form-item",{attrs:{label:"索引名",prop:"indexName"}},[n("help-popover",{attrs:{name:"index.indexName"}},[n("el-input",{attrs:{placeholder:"索引名，例如：IDX_ORDER_1"},model:{value:e.form.indexName,callback:function(t){e.$set(e.form,"indexName",t)},expression:"form.indexName"}})],1)],1),n("el-form-item",{attrs:{label:"字段",prop:"fieldIds"}},[n("help-popover",{attrs:{name:"index.fieldIds"}},[n("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.form.fieldIds,callback:function(t){e.$set(e.form,"fieldIds",t)},expression:"form.fieldIds"}},e._l(e.fieldList,function(e){return n("el-option",{key:e.fieldId,attrs:{label:e.fieldName,value:e.fieldId}})}),1)],1)],1),n("el-form-item",{attrs:{label:"是否唯一",prop:"unique"}},[n("help-popover",{attrs:{name:"index.unique"}},[n("el-radio-group",{model:{value:e.form.unique,callback:function(t){e.$set(e.form,"unique",t)},expression:"form.unique"}},e._l(e.boolOptions,function(t){return n("el-radio",{key:t.value,attrs:{border:"",label:t.value}},[e._v(e._s(t.label)+"\n              ")])}),1)],1)],1),n("el-form-item",{attrs:{label:"唯一性校验",prop:"uniqueCheck"}},[n("help-popover",{attrs:{name:"index.uniqueCheck"}},[n("el-radio-group",{attrs:{disabled:e.uniqueCheckDisabled},model:{value:e.form.uniqueCheck,callback:function(t){e.$set(e.form,"uniqueCheck",t)},expression:"form.uniqueCheck"}},e._l(e.boolOptions,function(t){return n("el-radio",{key:t.value,attrs:{border:"",label:t.value}},[e._v(e._s(t.label)+"\n              ")])}),1)],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")]),e.edit?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.reset()}}},[e._v("重置")]):e._e(),n("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1)],1)],1)],1)},ln=[];function sn(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sn(n,!0).forEach(function(t){Object(Oe["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var dn={name:"indexForm",props:["projectId","entityId","indexId","fieldIds"],data:function(){var e=!!this.indexId;return{edit:e,boolOptions:ye.boolOptions,fieldList:[],old:Zt(e),form:Zt(e),uniqueCheckDisabled:!1,rules:en()}},watch:{"form.indexName":function(e){var t=/[a-z]/i;t.test(e)&&(this.form.indexName=e.toUpperCase())},"form.unique":function(e){1===e?(this.form.uniqueCheck=1,this.uniqueCheckDisabled=!0):this.uniqueCheckDisabled=!1}},methods:{queryField:function(e){var t=this;return this.$common.getFieldOptions(e).then(function(e){return t.$common.checkResult(e)}).then(function(e){t.fieldList=e})},getIndex:function(){var e=this;return this.$ajax.get("/".concat(A,"/meta_index/").concat(this.indexId)).then(function(t){return e.$common.checkResult(t)}).then(function(t){var n=cn({},t);n.fieldIds=n.fields.map(function(e){return e.fieldId}),n.fields=null,e.old=n}).catch(function(t){return e.$common.showNotifyError(t)})},reset:function(){for(var e in Zt(!0))this.form[e]=this.old[e]},submit:function(){var e=this,t=cn({},this.form);t.fieldIds=this.form.fieldIds.join(",");var n=null;this.$refs.indexForm.validate().then(function(){return n=e.$loading(),e.edit?e.$ajax.put("/".concat(A,"/meta_index/update"),e.$common.removeBlankField(t)):e.$ajax.post("/".concat(A,"/meta_index/save"),e.$common.removeBlankField(t))}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","操作成功"),e.goBack()}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){n&&n.close()})},goBack:function(){this.$router.push("/project/".concat(this.projectId,"/entity/").concat(this.entityId,"/field"))}},created:function(){var e=this;this.edit?Promise.all([this.getIndex(),this.queryField(this.entityId)]).then(function(){return e.reset()}):(this.form.entityId=parseInt(this.entityId),this.fieldIds&&(this.form.fieldIds=this.fieldIds.split("-").map(function(e){return parseInt(e)})),this.queryField(this.form.entityId))}},un=dn,mn=(n("aa46"),Object(d["a"])(un,an,ln,!1,null,null,null)),pn=mn.exports,fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[n("keep-alive",{attrs:{include:"constList"}},[n("router-view")],1)],1)],1)},hn=[],gn={},yn=Object(d["a"])(gn,fn,hn,!1,null,null,null),bn=yn.exports,vn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"constList"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",[e._v("枚举管理")])],1),n("el-row",{staticStyle:{padding:"10px 0"},attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{staticClass:"activeNum",attrs:{span:6}},[e._v("\n      已选择"+e._s(e.activeNum)+"个枚举\n    ")]),n("el-col",{staticStyle:{"text-align":"right"},attrs:{span:18}},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm}},[n("el-form-item",[n("el-select",{attrs:{placeholder:"请选择项目"},on:{change:e.handleQuery},model:{value:e.queryForm.projectId,callback:function(t){e.$set(e.queryForm,"projectId",t)},expression:"queryForm.projectId"}},e._l(e.projectList,function(e){return n("el-option",{key:e.projectId,attrs:{label:e.projectDesc,value:e.projectId}})}),1)],1),n("el-form-item",[n("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.handleAdd(t)}}},[e._v("添加枚举")]),n("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.handleDel(t)}}},[e._v("删除枚举")])],1)],1)],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"constTable",staticStyle:{width:"100%"},attrs:{data:e.page.list,border:!0},on:{"selection-change":e.selectionChange,"expand-change":e.expandChange}},[n("el-table-column",{attrs:{type:"expand",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.detailLoading,expression:"detailLoading"}],staticClass:"detailTable",attrs:{data:e.detailList,"show-header":!1}},[n("el-table-column",{attrs:{width:"100"}}),n("el-table-column",{attrs:{label:"枚举值描述",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.detailRemark))]),t.row.editFlag?n("span",[n("el-input",{attrs:{placeholder:"值描述，如：女"},model:{value:t.row.detailRemark,callback:function(n){e.$set(t.row,"detailRemark",n)},expression:"detail.row.detailRemark"}})],1):e._e()]}}],null,!0)}),n("el-table-column",{attrs:{label:"枚举字段名",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.detailName))]),t.row.editFlag?n("span",[n("el-input",{attrs:{placeholder:"字段名，如：WOMAN"},on:{change:function(n){return e.detailNameChange(t.row)}},model:{value:t.row.detailName,callback:function(n){e.$set(t.row,"detailName",n)},expression:"detail.row.detailName"}})],1):e._e()]}}],null,!0)}),n("el-table-column",{attrs:{label:"枚举值"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editFlag?e._e():n("span",[e._v(e._s(t.row.detailValue))]),t.row.editFlag?n("span",[n("el-input",{attrs:{placeholder:"枚举值，如：2"},model:{value:t.row.detailValue,callback:function(n){e.$set(t.row,"detailValue",n)},expression:"detail.row.detailValue"}})],1):e._e()]}}],null,!0)}),n("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.editFlag?e._e():n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(t){return e.handleDetailEdit(r.row)}}},[e._v("编辑")]),r.row.editFlag?n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(t){return e.handleDetailSave(r.row)}}},[e._v("保存")]):e._e(),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleDetailDel(t.row,r.row)}}},[e._v("删除")])]}}],null,!0)})],1)]}}])}),n("el-table-column",{attrs:{type:"selection",width:"50"}}),n("el-table-column",{attrs:{property:"constRemark",label:"枚举名称 / 值描述",width:"250"}}),n("el-table-column",{attrs:{property:"constName",label:"枚举类名 / 字段名",width:"250"}}),n("el-table-column",{attrs:{label:"类型 / 枚举值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("optionLabel")(t.row.constType,"constTypeOptions"))+"\n      ")]}}])}),n("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{disabled:e.expandedRow!==t.row,type:"text",size:"medium"},on:{click:function(n){return e.handleDetailAdd(t.row)}}},[e._v("添加枚举值")])]}}])})],1),n("el-row",{staticStyle:{padding:"20px 0"},attrs:{type:"flex",justify:"end"}},[n("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-sizes":[10,20,30,40],"page-size":e.page.pageSize,layout:"sizes, prev, pager, next",total:e.page.total},on:{"size-change":e.sizeChange,"current-change":e.currentChange}})],1)],1)},wn=[];function In(e){var t={projectId:null,constRemark:"",constName:"",constType:""};return e&&(t["constId"]=null),t}function xn(){return{projectId:[{required:!0,type:"number",message:"请选择项目",trigger:"change"}],constRemark:[{required:!0,message:"请输入枚举名称",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],constName:[{required:!0,message:"请输入枚举类名",trigger:"blur"},{max:20,message:"长度不能超过20个字符",trigger:"blur"}],constType:[{required:!0,type:"number",message:"请选择类型",trigger:"change"}]}}function jn(e){var t={constId:null,detailName:"",detailValue:"",detailRemark:"",editFlag:!0};return e&&(t["constDetailId"]=null),t}function _n(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_n(n,!0).forEach(function(t){Object(Oe["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_n(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Fn=jn(!1),$n={name:"constList",props:["projectId","constId"],data:function(){return{query:{projectId:null},queryForm:{projectId:null},projectList:[],activeNum:0,selectItems:[],page:{currentPage:1,total:0,pageSize:20,list:[]},expandedRow:null,loading:!1,detailList:[],detailLoading:!1}},filters:{optionLabel:function(e,t){var n=ye[t],r=!0,o=!1,i=void 0;try{for(var a,l=n[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value;if(s.value===e)return s.label}}catch(c){o=!0,i=c}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}return null}},methods:{selectionChange:function(e){this.selectItems=e,this.activeNum=this.selectItems.length},handleDel:function(){var e=this;this.activeNum<=0?this.$common.showMsg("warning","请选择枚举"):this.$common.confirm("是否确认删除").then(function(){return e.$ajax.put("/".concat(A,"/meta_const/deleteBatch"),e.selectItems.map(function(e){return e.constId}))}).then(function(t){return e.$common.checkResult(t)}).then(function(){return e.doQuery()}).catch(function(t){return e.$common.showNotifyError(t)})},sizeChange:function(e){this.page.pageSize=e,this.doQuery()},currentChange:function(e){this.page.currentPage=e,this.doQuery()},queryProject:function(){var e=this;return this.$common.getProjectOptions().then(function(t){return e.$common.checkResult(t)}).then(function(t){e.projectList=t})},handleQuery:function(){this.query=kn({},this.queryForm),this.query.projectId!==parseInt(this.projectId)&&this.$router.push("/project/".concat(this.query.projectId,"/const")),this.doQuery()},doQuery:function(){var e=this;if(this.query.projectId){var t=kn({},this.query,{currentPage:this.page.currentPage,pageSize:this.page.pageSize});return this.loading=!0,this.$ajax.get("/".concat(A,"/meta_const/list"),{params:t}).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.page=t}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){e.loading=!1})}},handleAdd:function(){this.$router.push("/project/".concat(this.projectId,"/const/add"))},handleEdit:function(e){this.$router.push("/project/".concat(this.projectId,"/const/edit/").concat(e.constId))},handleShow:function(e){this.$router.push("/project/".concat(this.projectId,"/const/show/").concat(e.constId))},expandChange:function(e,t){if(t&&t.length>1){this.detailList=[];var n=t.find(function(t){return t!==e});this.$refs.constTable.toggleRowExpansion(n,!1),this.doDetailQuery(e.constId),this.expandedRow=e}else t&&1===t.length&&this.expandedRow!==e&&(this.doDetailQuery(t[0].constId),this.expandedRow=t[0]);t&&0!==t.length||(this.expandedRow=null,this.detailList=[])},doDetailQuery:function(e){var t=this;this.detailLoading=!0,this.$ajax.get("/".concat(A,"/meta_const_detail/list"),{params:{projectId:this.query.projectId,constId:e}}).then(function(e){return t.$common.checkResult(e)}).then(function(e){t.detailList=e}).catch(function(e){return t.$common.showNotifyError(e)}).finally(function(){t.detailLoading=!1})},handleDetailAdd:function(e){var t=Object.assign({},Fn,{constId:e.constId});this.detailList.unshift(t)},handleDetailEdit:function(e){r["default"].set(e,"editFlag",!0)},handleDetailSave:function(e){var t=this,n="/".concat(A,"/meta_const_detail/save"),r="post";e.constDetailId&&(n="/".concat(A,"/meta_const_detail/update"),r="put");var o=this.$loading();this.$ajax[r](n,e).then(function(e){return t.$common.checkResult(e)}).then(function(n){return t.$common.showMsg("success","保存成功"),e.constDetailId||(e.constDetailId=n.constDetailId),t.$ajax.get("/".concat(A,"/meta_const_detail/").concat(e.constDetailId))}).then(function(e){return t.$common.checkResult(e)}).then(function(t){Object.assign(e,t,{editFlag:!1})}).catch(function(e){return t.$common.showNotifyError(e)}).finally(function(){o&&o.close()})},handleDetailDel:function(e,t){var n=this;this.$common.confirm("是否确认删除枚举值").then(function(){return n.$ajax.put("/".concat(A,"/meta_const_detail/deleteBatch"),[t.constDetailId])}).then(function(e){return n.$common.checkResult(e)}).then(function(){return n.doDetailQuery(e.constId)}).catch(function(e){return n.$common.showNotifyError(e)})},detailNameChange:function(e){var t=/[a-z]/i;t.test(e.detailName)&&(e.detailName=e.detailName.toUpperCase())}},activated:function(){var e=this;this.queryProject().then(function(){e.queryForm.projectId=parseInt(e.projectId),e.query.projectId=e.queryForm.projectId}).then(function(){return e.doQuery()}).then(function(){if(e.constId){var t=e.page.list.find(function(t){return t.constId===parseInt(e.constId)});e.$refs.constTable.toggleRowExpansion(t,!0)}})}},Nn=$n,En=(n("6969"),Object(d["a"])(Nn,vn,wn,!1,null,null,null)),Tn=En.exports,Cn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"constFormDiv"},[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/project"}}},[e._v("项目管理")]),n("el-breadcrumb-item",{attrs:{to:{path:"/project/"+this.projectId+"/const"}}},[e._v("枚举管理")]),n("el-breadcrumb-item",[e._v("\n      "+e._s(e.edit?"编辑枚举":"添加枚举")+"\n    ")])],1),n("el-row",{attrs:{type:"flex",align:"middle",gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"constForm",staticClass:"constForm",attrs:{rules:e.rules,model:e.form,"label-width":"80px",size:"small"}},[n("el-form-item",{attrs:{label:"项目",prop:"projectId"}},[n("help-popover",{attrs:{name:"const.projectId"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择项目",disabled:!0},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}},e._l(e.projectList,function(e){return n("el-option",{key:e.projectId,attrs:{label:e.projectDesc,value:e.projectId}})}),1)],1)],1),n("el-form-item",{attrs:{label:"枚举名称",prop:"constRemark"}},[n("help-popover",{attrs:{name:"const.constRemark"}},[n("el-input",{attrs:{placeholder:"例如：性别"},model:{value:e.form.constRemark,callback:function(t){e.$set(e.form,"constRemark",t)},expression:"form.constRemark"}})],1)],1),n("el-form-item",{attrs:{label:"枚举类名",prop:"constName"}},[n("help-popover",{attrs:{name:"const.constName"}},[n("el-input",{attrs:{placeholder:"例如：Sex"},model:{value:e.form.constName,callback:function(t){e.$set(e.form,"constName",t)},expression:"form.constName"}})],1)],1),n("el-form-item",{attrs:{label:"类型",prop:"constType"}},[n("help-popover",{attrs:{name:"const.constType"}},[n("el-radio-group",{model:{value:e.form.constType,callback:function(t){e.$set(e.form,"constType",t)},expression:"form.constType"}},e._l(e.constTypeOptions,function(t){return n("el-radio",{key:t.value,attrs:{border:"",label:t.value}},[e._v(e._s(t.label))])}),1)],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")]),e.edit?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.reset()}}},[e._v("重置")]):e._e(),n("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1)],1)],1)],1)},On=[],qn={name:"constForm",props:["projectId","constId"],data:function(){var e=!!this.constId;return{edit:e,constTypeOptions:ye.constTypeOptions,projectList:[],old:In(e),form:In(e),rules:xn()}},methods:{queryProject:function(){var e=this;return this.$common.getProjectOptions().then(function(t){return e.$common.checkResult(t)}).then(function(t){e.projectList=t})},getConst:function(){var e=this;return this.$ajax.get("/".concat(A,"/meta_const/").concat(this.constId)).then(function(t){return e.$common.checkResult(t)}).then(function(t){e.old=t}).catch(function(t){return e.$common.showNotifyError(t)})},reset:function(){for(var e in In(!0))this.form[e]=this.old[e]},submit:function(){var e=this,t=null;this.$refs.constForm.validate().then(function(){return t=e.$loading(),e.edit?e.$ajax.put("/".concat(A,"/meta_const/update"),e.form):e.$ajax.post("/".concat(A,"/meta_const/save"),e.form)}).then(function(t){return e.$common.checkResult(t)}).then(function(){e.$common.showMsg("success","操作成功"),e.goBack()}).catch(function(t){return e.$common.showNotifyError(t)}).finally(function(){t&&t.close()})},goBack:function(){this.$router.push("/project/".concat(this.projectId,"/const"))}},created:function(){var e=this;this.edit?Promise.all([this.getConst(),this.queryProject()]).then(function(){return e.reset()}):this.queryProject().then(function(){e.form.projectId=parseInt(e.projectId)})}},Sn=qn,Dn=(n("7966"),Object(d["a"])(Sn,Cn,On,!1,null,null,null)),Ln=Dn.exports;r["default"].use(p["a"]);var Pn=new p["a"]({routes:[{path:"",component:_},{path:"/project",component:E,children:[{path:"",component:ae},{path:"add",component:je},{path:"edit/:projectId",component:je,props:!0}]},{path:"/project/:projectId/entity",component:Ne,props:!0,children:[{path:"",component:Ue,props:!0},{path:"add",component:nt,props:!0},{path:"edit/:entityId",component:nt,props:!0},{path:"mtmEdit/:mtmId",component:st,props:!0},{path:"mtmAdd/:entityIds?",component:st,props:!0}]},{path:"/project/:projectId/entity/:entityId/field",component:pt,props:!0,children:[{path:"",component:Jt,props:!0},{path:"add",component:on,props:!0},{path:"edit/:fieldId",component:on,props:!0},{path:"indexAdd/:fieldIds?",component:pn,props:!0},{path:"indexEdit/:indexId",component:pn,props:!0}]},{path:"/project/:projectId/const",component:bn,props:!0,children:[{path:"add",component:Ln,props:!0},{path:":constId?",component:Tn,props:!0},{path:"edit/:constId",component:Ln,props:!0}]}],scrollBehavior:function(e,t,n){return{x:0,y:0}}});r["default"].use(zt["a"]);var Rn=new zt["a"].Store({state:{cacheFieldTemplateCount:0,cacheFieldTemplate:[],toCacheFieldTemplate:[]},getters:{fieldCached:function(e){return function(t){return!!e.cacheFieldTemplate.find(function(e){return e.fieldId===t})}},fieldToCache:function(e){return function(t){return!!e.toCacheFieldTemplate.find(function(e){return e.fieldId===t})}}},mutations:{removeFieldTemplate:function(e,t){var n=e.cacheFieldTemplate.findIndex(function(e){return e.fieldId===t});n>-1&&(e.cacheFieldTemplate.splice(n,1),e.cacheFieldTemplateCount--)},addFieldTemplate:function(e,t){var n=e.cacheFieldTemplate.findIndex(function(e){return e.fieldId===t.fieldId});n<0&&(e.cacheFieldTemplate.push(t),e.cacheFieldTemplateCount++)},addToCacheFieldTemplate:function(e,t){var n=e.toCacheFieldTemplate.findIndex(function(e){return e.fieldId===t.fieldId});n<0&&e.toCacheFieldTemplate.push(t)},removeToCacheFieldTemplate:function(e,t){var n=e.toCacheFieldTemplate.findIndex(function(e){return e.fieldId===t.fieldId});n>-1&&e.toCacheFieldTemplate.splice(n,1)}}}),Mn=(n("b383"),n("79f6"),n("d06d"),n("0874")),An=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"help-popover"},[n("el-popover",{ref:"popover",attrs:{placement:"right",width:"400",trigger:"click"}},[n("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(e.markdown)}})]),n("el-col",{attrs:{span:22}},[e._t("default")],2),n("el-col",{attrs:{span:2}},[n("icon",{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],staticClass:"question-circle",attrs:{name:"regular/question-circle"}})],1)],1)},Bn=[],zn=n("768b"),Vn=(n("ffc1"),{project:{groupId:"\n**groupId**：maven项目的groupId，主要影响pom文件\n    ",projectName:"\n**项目名称**：整个项目的唯一标识\n> 注意：只允许输入英文小写字母 “a-z”或短横杠 “-”\n    ",packageName:"\n**包名**：生成的核心代码所属包路径\n> 注意：请遵循开发规范，尽量只输入英文小写字母 “a-z”及路径分隔符 “.”\n    ",author:"\n**作者**：生成的代码中会注明作者，此外并无其他用途\n    ",remote:"\n**启用Git仓库**：启用以后，可以将代码同步到git仓库，可以实现代码增量生成\n    ",remoteUrl:"\n**Git仓库地址**：远程Git仓库地址，可以是github、码云、gitlab私有仓库等\n> 注意：请使用新创建的空仓库，不要有任何内容。\n    ",username:"\n**Git用户名/oauth2**：请填写一个有代码提交权限的用户名,如果使用access token则填入oauth2\n    ",password:"\n**Git密码/token**：密码/token不会回显，如果不想修改请置空\n    ",feature:{bootVersion:"\n**spring-boot版本**：生成的基本框架所依赖的spring-boot版本\n      "}},entity:{projectId:"\n**项目**：本实体所属项目\n    ",title:"\n**实体名**：本实体的中文名称，会出现在多处代码及表结构的注释中\n> 注意：请尽量使用言简意赅的名称\n    ",className:"\n**类名**：生成的java bean名称，比如输入类名User,会生成的bean有:UserPO、UserAddDTO、UserDAO等\n> 注意：第一个字母请大写\n    ",tableName:"\n**表名**：生成的业务表名称\n> 注意：请按mysql表名规范来命名，尽量使用下划线来分隔单词\n    ",pageSign:"\n**分页**：生成的查询服务返回结果是否需要分页展示\n    ",desc:"\n**描述**：会出现在建表语句的备注中\n    "},field:{jfieldName:"\n**java字段名**：Java类中的字段名称，请遵循Java字段命名规范，尽量使用驼峰格式\n\n**mysql字段名**：业务表中的字段名称，请遵循mysql字段命名规范，尽量使用下划线来分隔单词\n    ",fieldName:"\n**mysql字段名**：业务表中的字段名称\n> 注意：请遵循mysql字段命名规范，尽量使用下划线来分隔单词\n    ",fieldDesc:"\n**字段描述**：本字段的中文描述\n> 该描述不会对生成的代码产生影响\n    ",fieldType:"\n**java字段类型**：实体类中的java字段类型\n    \n**mysql字段类型**：数据库中的字段类型\n\n**字段长度**：字段长度限制。\n\n1. 首先会影响表结构里面的字段长度\n2. 新增和修改服务也会对DTO中的参数进行长度校验\n\n**字段精度**：只会影响表结构中的字段精度\n    ",primaryKey:"\n**是否主键**：标识当前字段是否业务表中的主键字段\n> 注意：一个实体必须有且只有一个主键\n\n**是否自增**：主键的生成策略\n    ",notNull:"\n**不能为空**：是否非空字段\n    ",foreignKey:'\n**是否外键**：本字段是否跟其他实体的主键字段关联，可以用来实现“一对一”、“一对多”关联，外键支持`级联扩展`\n\n**注意：这里的外键只是个逻辑上的概念，并不会在表里生成物理外键**\n\n**使用外键后的效果1**：新增或修改实体时会校验关联实体是否存在\n```\n@Transactional(rollbackFor = RuntimeException.class)\npublic DeveloperPO save(DeveloperAddDTO developerDTO) {\n    DeveloperPO developer = DeveloperMapper.INSTANCE.fromAddDTO(developerDTO);\n    if(developer.getUserId() != null){\n        Assert.isTrue(userDAO.exist(developer.getUserId()),"用户id有误");\n    }\n    developerDAO.save(developer);\n    return developer;\n}\n\n```\n\n\n**使用外键后的效果2**：删除实体时会校验当前实体是否有被其他实体的外键引用\n```\n@Transactional(rollbackFor = RuntimeException.class)\npublic int delete(Long... userIds) {\n    int count = 0;\n    for (Long userId : userIds) {\n        this.checkDeleteByDeveloper(userId);\n        count += userDAO.delete(userId);\n    }\n    return count;\n}\n```\n\n    ',fieldExample:"\n**字段示例**：有两个作用\n1. 生成的swagger文档中，出入参示例来源于此\n2. 生成的单元测试中，会用字段示例作为测试参数\n> 所以请认真写一下示例！\n    ",fieldComment:"\n**字段备注**：对该字段的详细说明，有两个作用\n1. 生成的swagger文档中，出入参结构中会用到字段备注\n2. 生成的表结构中，每个字段都有备注\n> 请认真填写备注，详细的备注有助于别人理解！\n    ",dicType:"\n**枚举字典**：当前字段的值是否来源于枚举\n\n系统默认枚举有：\n- BoolConst：1是，0否\n    ",query:'\n**可搜索**：如果字段可搜索，则当前字段会出现在查询参数中，当然也会出现在查询sql的where语句中。\n\n**搜索方式**：决定sql的查询运算符，如果是between类型，则会生成前后两个查询字段。\n```\n//注册开始时间\n@ApiModelProperty(notes = N_REGTIME,example = E_REGTIME)\n@JsonFormat(pattern=JsonFieldConst.DEFAULT_DATETIME_FORMAT,timezone="GMT+8")\nprivate Date regTimeStart;\n\n//注册结束时间\n@ApiModelProperty(notes = N_REGTIME,example = E_REGTIME)\n@JsonFormat(pattern=JsonFieldConst.DEFAULT_DATETIME_FORMAT,timezone="GMT+8")\nprivate Date regTimeEnd;\n\n```\n    ',attributes:'\n**可插入**：如果字段可插入，则会出现在新增服务的外部入参中，\n否则就是需要在save方法中设置默认值。\n\n**可修改**：如果字段可修改，则会出现在修改服务的外部入参中，\n否则代表该字段不允许用户修改。比如“主键”字段，应该设置成不可修改。\n\n**列表展示**：如果字段支持列表展示，则会出现在列表查询服务的返回结果中。\n\n**详情展示**：如果字段支持详情展示，则会出现查看详情服务的返回结果中\n\n**可排序**：如果字段可排序，则会在列表查询入参中加入排序参数，前端就可以自由指定如何排序。\n```\n@ApiModelProperty(notes = "发布标识排序标识【1升序,-1降序,0不排序】",example = "1")\nprivate Integer publishSignSortSign;\n```\n    ',orderNo:"\n**序号**：只影响当前字段在实体中的先后顺序，将功能接近的字段放在一起，会比较美观。\n\n**特殊字段类型**：有特殊意义的字段类型\n- 逻辑删除：如果当前实体存在逻辑删除字段，那么调用删除方法的时候，只会将该字段改为1（默认值是0），而不是物理删除。\n- 创建时间：创建实体的时候，会自动对本字段设值为当前时间\n- 创建人员：记录下谁创建了本实体\n- 更新时间：修改实体的时候，会自动对本字段设值为当前时间\n- 更新人员：记录下是谁最后一次修改了本实体\n- 乐观锁版本号：防止并发更新记录时出现脏数据，使用版本号字段进行控制\n\n    "},const:{projectId:"\n**项目**：当前枚举所属项目\n    ",constRemark:"\n**枚举名称**：枚举的中文名称\n    ",constName:"\n**枚举类名**：Java枚举类的类名，请一定要符合类名规范。\n    ",constType:"\n**类型**：指定下属枚举值的字段类型\n    "},constDetail:{detailName:"\n**枚举字段名**：Java枚举类中的字段名称，必须是大写，单词间用下划线分隔\n    ",detailValue:"\n**枚举值**：枚举字段的值，如果枚举类型是整数，则必须是数字\n    ",detailRemark:'\n**值描述**：枚举值的中文描述，对应枚举类中desc属性的值\n#### 生成的枚举类会包含两个属性，请看下面示例：\n```\n/**\n * <p>Title: 枚举【开发者类型】</p>\n * <p>Description: </p>\n * @author cbb\n * @date 2018/03/09\n */\npublic enum DevType {\n\n    PERSONAL(1,"个人"),\n    COMPANY(2,"公司");\n\n    private final Integer value;\n    private final String desc;\n\n    private static final Map<Integer, DevType> lookup = new HashMap<>();\n\n    static {\n        for (DevType e : DevType.values()) {\n            lookup.put(e.value, e);\n        }\n    }\n    \n    ......\n}\n```\n\n    '},mtm:{projectId:"\n**项目**：当前多对多所属项目\n    ",tableName:"\n**关联表名**：由于一个多对多关系会生成一张关联表，此处填写该关联表表名。\n    ",desc:"\n**描述**：用于生成关联表的备注信息\n    ",entityId1:"\n**实体1**：多对多的其中一方\n\n**持有引用**：持有引用的一方可以主动维护多对多关联关系，包括添加、删除关联等操作\n    ",entityId2:"\n**实体2**：多对多的另一方\n\n**持有引用**：持有引用的一方可以主动维护多对多关联关系，包括添加、删除关联等操作\n    ",entityIdField1:"\n**实体1外键字段**：默认会根据实体名自动生成，也可以手动指定\n    ",entityIdField2:"\n**实体2外键字段**：默认会根据实体名自动生成，也可以手动指定\n    ",needId:"\n**自增id**：关联表是否需要生成一个自增主键id\n\n**id类型**：可选择长整型bigint和整型int两种，一般情况使用整型int即可\n    "},index:{indexName:"\n**索引名**：生成数据库索引的名称\n    ",fieldIds:"\n**字段**：生成索引的表字段\n    ",unique:"\n**是否唯一**：唯一索引可以从数据库层面限制字段唯一性\n> 注意：如果实体中存在逻辑删除字段，则尽量不要使用唯一索引，而是用“普通索引”+“唯一性校验”来替代\n    ",uniqueCheck:"\n**唯一性校验**：插入或修改记录时，是否需要提前进行索引唯一性校验\n    "},fieldListHelp:"\n**快速复制字段攻略**\n\n![image]({copyField})\n\n\n"}),Qn=new y.a.Converter({emoji:"true"}),Kn={name:"help-popover",props:["name","pic"],data:function(){var e=Vn;if(this.name.split(".").forEach(function(t){e=e[t]}),this.pic)for(var t=0,n=Object.entries(this.pic);t<n.length;t++){var r=Object(zn["a"])(n[t],2),o=r[0],i=r[1];e=e.replace("{"+o+"}",i)}return{markdown:Qn.makeHtml(e)}}},Un=Kn,Gn=(n("0540"),Object(d["a"])(Un,An,Bn,!1,null,null,null)),Jn=Gn.exports,Hn=n("b085"),Wn=Object(Hn["a"])();"chrome"!==Wn.name&&alert("建议使用chrome浏览器，其他浏览器可能存在兼容性问题"),r["default"].config.productionTip=!1,r["default"].use(i.a),r["default"].use(z),r["default"].component("icon",Mn["a"]),r["default"].component("help-popover",Jn),new r["default"]({store:Rn,router:Pn,render:function(e){return e(m)}}).$mount("#app")},"5d67":function(e,t,n){},"624f":function(e,t,n){},6969:function(e,t,n){"use strict";var r=n("a69c"),o=n.n(r);o.a},7966:function(e,t,n){"use strict";var r=n("d353"),o=n.n(r);o.a},"79f6":function(e,t,n){},"80ab":function(e,t,n){"use strict";var r=n("b839"),o=n.n(r);o.a},9851:function(e,t,n){},"9f76":function(e,t,n){},a69c:function(e,t,n){},aa46:function(e,t,n){"use strict";var r=n("9f76"),o=n.n(r);o.a},ad44:function(e,t,n){e.exports=n.p+"static/img/copyField.5ee9f56b.gif"},b383:function(e,t,n){},b47b:function(e,t,n){},b839:function(e,t,n){},bb43:function(e,t,n){},cd65:function(e,t,n){},d353:function(e,t,n){},d48f:function(e,t,n){},d5b3:function(e,t,n){},eb47:function(e,t,n){},f4ca:function(e,t,n){"use strict";var r=n("31b5"),o=n.n(r);o.a}});
//# sourceMappingURL=app.7a883b34.js.map