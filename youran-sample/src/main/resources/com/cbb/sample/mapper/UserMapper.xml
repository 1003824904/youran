<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cbb.sample.mapper.UserMapper">
    <select id="findById" resultType="UserPO">
        select * from user
        where delSign=0
        and id = #{arg0,jdbcType=INTEGER}
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="UserPO">
        insert into user(
            id,
            userName,
            sex,
            birthday,
            createDate,
            createBy,
            operateDate,
            operateBy,
            version,
            delSign)
        VALUES (
            #{id,jdbcType=INTEGER},
            #{userName,jdbcType=VARCHAR},
            #{sex,jdbcType=INTEGER},
            #{birthday,jdbcType=TIMESTAMP},
            #{createDate,jdbcType=TIMESTAMP},
            #{createBy,jdbcType=VARCHAR},
            #{operateDate,jdbcType=TIMESTAMP},
            #{operateBy,jdbcType=VARCHAR},
            #{version,jdbcType=INTEGER},
            #{delSign,jdbcType=INTEGER})
    </insert>


    <update id="update" parameterType="UserPO">
        update user set
            userName=#{userName,jdbcType=VARCHAR},
            sex=#{sex,jdbcType=INTEGER},
            birthday=#{birthday,jdbcType=TIMESTAMP},
            operateDate=#{operateDate,jdbcType=TIMESTAMP},
            operateBy=#{operateBy,jdbcType=VARCHAR},
            version=version+1
        where id=#{id,jdbcType=INTEGER}
        and version=#{version,jdbcType=INTEGER}
        and delSign=0
    </update>

    <delete id="delete">
        update user set
            delSign=1
        where id=#{id,jdbcType=INTEGER}
        and delSign=0
    </delete>


    <sql id="queryCondition">
        <if test="userName != null and userName !='' ">
            and t.userName like #{userName}
        </if>
        <if test="sex != null">
            and t.sex = #{sex,jdbcType=INTEGER}
        </if>
        <if test="birthdayStart != null">
            and t.birthday >= #{birthdayStart,jdbcType=TIMESTAMP}
        </if>
        <if test="birthdayEnd != null">
            and t.birthday &lt;= #{birthdayEnd,jdbcType=TIMESTAMP}
        </if>
    </sql>

    <select id="findCountByQuery" parameterType="UserQueryDTO" resultType="int">
        select count(*) from (
            select * from user t
            where t.delSign=0
            <include refid="queryCondition"/>
        ) as count_select_
    </select>

    <select id="findListByQuery" parameterType="UserQueryDTO" resultType="UserListVO">
        select * from user t
        where t.delSign=0
        <include refid="queryCondition"/>
        limit #{startIndex},#{pageSize}
    </select>

</mapper>
